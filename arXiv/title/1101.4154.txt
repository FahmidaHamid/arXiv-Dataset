Epidemics and vaccination on weighted graphs