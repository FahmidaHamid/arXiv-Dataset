Bayesian Model Comparison in Genetic

arXiv:1404.7197v2 [stat.ME] 23 Feb 2015

Association Analysis: Linear Mixed Modeling
and SNP Set Testing
Xiaoquan Wen
Department of Biostatistics, University of Michigan, Ann Arbor, USA

Abstract
We consider the problems of hypothesis testing and model comparison under a flexible
Bayesian linear regression model whose formulation is closely connected with the linear
mixed effect model and the parametric models for SNP set analysis in genetic association
studies. We derive a class of analytic approximate Bayes factors and illustrate their connections with a variety of frequentist test statistics, including the Wald statistic and the
variance component score statistic. Taking advantage of Bayesian model averaging and
hierarchical modeling, we demonstrate some distinct advantages and flexibilities in the approaches utilizing the derived Bayes factors in the context of genetic association studies.
We demonstrate our proposed methods using real or simulated numerical examples in applications of single SNP association testing, multi-locus fine-mapping and SNP set association
testing.
Keywords: Bayes factor; Linear mixed model; SNP set analysis; Genetic association;
Model comparison

1

1

Introduction

In the past decades, genetic association studies have taken a prominent position in uncovering
the role of genetic variants in disease etiology. Most recently, two related statistical approaches
have become especially important in the analysis of genetic association data: the use of linear
mixed models (LMM) to control for confounding factors and account for polygenic effects and the
application of SNP set analysis for regions of (rare) genetic variants. As demonstrated by many
authors (Kang et al., 2010, Segura et al., 2012, Zhou and Stephens, 2012, Zhou et al., 2013),
linear mixed models effectively thwart the identification of false positive associations caused
by relatedness or population structures (e.g., cryptic relatedness) in the samples while at the
same time increase the power of detecting genuine genetic association signals. SNP set testing
(Madsen and Browning, 2009, Wu et al., 2011, Lee et al., 2012) is emerging as a method of
choice in detecting associations of rare genetic variants, which may be critical in explaining the
phenomenon of “missing heritability”. Recent studies have also shown the necessity of jointly
applying both approaches when analyzing the genetic association of rare variants to control for
population stratification or using pedigree data.
Currently, the majority of the methodological work employing LMM and/or SNP set analysis
in genetic association studies has focused on reporting p-values for hypothesis testing. In this
paper, we discuss a Bayesian alternative to address both topics within the model comparison
framework in which hypothesis testing is regarded as a special case. We first show that both
problems can be naturally formulated by a unified Bayesian parametric model, and we then
derive a class of analytic approximate Bayes factors for use as our primary statistical device
for model comparison. We establish the connections between the approximate Bayes factors and
various commonly applied frequentist test statistics in a similar fashion, as reported by Wakefield
(2009), Wen (2014), Wen and Stephens (2014).
Despite its similarities in performance to the frequentist approaches in traditional hypothesis
2

testing settings, the Bayesian approach exhibits great convenience and flexibility in dealing with
complicated practical settings within and beyond hypothesis testing. One of the most significant
advantages of the Bayesian comparison method is its acceptance of explicitly modeling various
alternative scenarios (which are not necessarily nested) and the fluidity with which it combines
the evidence from the data via Bayesian model averaging. Beyond single unit (i.e., either a SNP
or a SNP set) association testing, we show that the Bayesian model comparison approach can
be straightforwardly extended to a joint analysis of multiple association signals, especially when
dealing with linkage disequilibrium (LD) among SNPs commonly present in the genetic data. We
illustrate a highly-efficient multi-locus fine-mapping approach that is facilitated by our results
based on approximate Bayes factors.

2

Model and Notations

We consider a general form of the linear mixed model,

y = Xα + Gβ + u + e, e ∼ N(0, τ −1 I),

(2.1)

where y is an n-vector of quantitative response measurements, X is an n × q matrix of covariate
variables to be controlled as fixed effects and their coefficients are encoded in the q-vector α. G
is an n × p matrix of covariates whose effect, represented by the p-vector β, is of primary interest
for inference. Finally, the n-vectors u and e represent the random effects and the i.i.d residual
errors, respectively. In the general LMM inference framework, the random effects vector, u, is
assumed to be drawn from a multivariate normal (MVN) distribution, i.e.,

u ∼ N(0, λτ −1 K),

(2.2)

3

where the n × n matrix K is assumed known (while the variance component parameter λ is
typically unknown). In typical genetic applications, G represents the genotypes of p candidate
SNPs, X includes intercept term and factors like age, sex that need to be controlled for, and u
usually represents the random effects due to cryptic genetic relatedness or population structure.
The ultimate goal is to make inference of the genetic effect β.
We now present a Bayesian counterpart of the LMM, the likelihood part of which is identical
to (2.1). From the Bayesian perspective, it is natural to regard the “random effect” assumption
(2.2) as a standard MVN prior on u. For controlled “fixed” effect coefficient α, we assume the
MVN prior:

α ∼ N(0, Ψ),

(2.3)

where Ψ is a diagonal matrix. When performing inference, we take the limit Ψ−1 → 0, which
essentially assigns independent flat priors to each fixed effect coefficient. A flat prior might be
interpreted as an assumption that the a priori effects of α are extremely large. This assumption
intuitively leads to a conservative inference on β. However, for variables that must be controlled
for, such conservative assumptions are most likely welcome.
We also assign an MVN prior for the parameter of interest, β, such that

β ∼ N(0, W ).

(2.4)

The variance-covariance matrix W fully characterizes a distinct candidate model in our model
comparison framework. The choice of W is context-dependent and has critical implications on
the inference results. In practice, we recommend modeling the effect size on the unit-free scales
of signal-noise ratios (Wen, 2014, Wen and Stephens, 2014) by assigning an MVN prior on the
√
standardized effect, i.e., τ β ∼ N(0, Φ), which induces a prior variance matrix on the original

4

scale of β as W = τ −1 Φ. (Note that the prior on the random effect u is formulated in the same
scale.)
Finally, we assume a general joint prior distribution, p(λ, τ ), for the variance component parameters. As we will show later, the actual functional form of p(λ, τ ) has little impact on our
asymptotic approximations of Bayes factors. To emphasize the connection with the frequentist
linear mixed effect model, we will henceforth call the above Bayesian linear regression model the
Bayesian linear mixed effect model (BLMM).

3

Model Comparison in the BLMM

We derive Bayes factors for the BLMM in order to perform Bayesian model comparisons. More
specifically, we consider a space of candidate BLMMs that only differ in their specifications of
W . We denote H0 as the trivial null model, in which β ≡ 0 (or equivalently W = 0), and we
define a null-based Bayes factor for an alternative model characterized by its prior variance on
β as
P (y | X, G, K, W )
P (y | X, G, K, W )
=
lim
.
BF(W ) = lim
Ψ−1 →0 P (y | X, G, K, H0 ) Ψ−1 →0 P (y | X, G, K, W = 0)

(3.1)

To present our results regarding the Bayes factors, we begin by introducing several necessary
additional notations. We denote α̂, β̂, λ̂ and τ̂ as the MLEs of the full LMM model (2.1) by
treating β as a fixed effect parameter. In addition, we denote V̂ = Var(β̂). Correspondingly, we
use α̃, τ̃ and λ̃ to represent the MLEs of the null model, where β is restricted to 0. Furthermore,
provided that parameter λ is known, we note that β̂ can be analytically computed as a function
of λ (Appendix A.1), which we denote by β̂(λ). Accordingly, we use V̂ (λ, τ ) to represent the
corresponding variance of β̂(λ) (specifically, when λ = λ̂, β̂(λ̂) = β̂ and V̂ (λ̂, τ̂ ) = V̂ ). Finally,
we consider a class of general estimators of λ, denoted by λ̌, for which a tuning parameter
5

κ ∈ [0, 1] is built-in. The statistical details of this class of estimators are explained in Appendix
A.2. Most importantly, it follows that λ̌(κ = 0) = λ̃, and λ̌(κ = 1) = λ̂ for the two extreme κ
values. Deriving from λ̌, we establish a corresponding estimator of τ , denoted by τ̌ (κ), which
can be analytically expressed in terms of λ̌ (see Appendix A.2) and also shares a similar property
such that τ̌ (κ = 0) = τ̃ , and τ̌ (κ = 1) = τ̂ . Finally, we use the notations β̌ = β̂(λ̌), V̌ = V̂ (λ̌, τ̌ ).
In the case that W is specified as a function of λ and/or τ , we denote W̌ = W (λ̌, τ̌ ). With these
additional notations, we show that the desired Bayes factor can be approximated analytically.
We summarize the main result in proposition 1, whose formal proof is given in Appendix A.2.
PROPOSITION 1. Under the BLMM, the Bayes factor can be approximated by

ABF(W , κ) = |I + V̌

−1

− 12

W̌ |


· exp

i −1 
1 0 −1 h
−1
−1
β̌ V̌
W̌ (I + V̌ W̌ )
V̌ β̌ .
2

(3.2)

It follows that

 
1
BF(W ) = ABF(W , κ) · 1 + O
, for any κ ∈ [0, 1].
n

Remark 1. The approximate Bayes factors in the BLMM share the same functional form as the
ABFs discussed in Wen (2014) and enjoy some of the computational properties discussed therein.
In particular, the computation of the ABF is robust to the potential collinearity presented in the
data matrix G. Furthermore, W is allowed to be rank-deficient.
Remark 2. For single SNP analysis, i.e., p = 1, both W̌ and V̌ degenerate to scalars (which
we denote by ω̌ and v̌, respectively). The expression of (3.2) is reduced to
r
ABF(ω, κ) =

v̌
exp
v̌ + ω̌



1 ω̌ β̌ 2
2 v̌ + ω̌ v̌


,

(3.3)

which has the same functional form as the ABF discussed in Wakefield (2009).

6

Although all suitable κ values yield the same asymptotic error bound, they have practical implications on the approximation accuracy for finite samples. Our numerical experiments (Appendix
B) indicate that with sample size around hundreds, the ABFs with κ = 0 and κ = 1 both become
quite accurate.

3.1
3.1.1

Connection with frequentist test statistics
Connection with fixed effect test statistics

Consider a specific class of prior, W = cV , for which the ABF can be simplified to
r
ABF(W = cV , κ) =

1
c+1

!p


exp


1 c
0 −1
β̌ V̌ β̌ .
2c+1
0

Consequently, the ABF becomes a monotonic transformation of the quadratic form β̌ V̌

−1

β̌. We

note that, in the following two special cases, the quadratic form corresponds to some popular
frequentist statistics to test β as a fixed effect. Particularly, when κ = 1, the quadratic form
0

becomes the (multivariate) Wald statistic β̂ V̂

−1

β̂; as κ is set to 0, it coincides with the Rao’s

score statistic (Appendix C.1).
The monotonic correspondence between the ABF and these two popular frequentist test statistics
indicates that, under the prior specified, the ABF ranks candidate models (or SNP associations
in single-SNP analysis) exactly the same way as both the Wald statistic (for κ = 1) and the score
statistic (for κ = 0). Furthermore, applying the strategy of Bayes/non-Bayes compromise (Good,
1992, Servin and Stephens, 2007) by treating the ABF as a regular test statistic, it becomes
obvious that the ABF possesses a p-value identical to that of the corresponding Wald or score
statistic, depending on the κ values. Wakefield (2009) first named the prior specification of the
kind W = cV as the implicit p-value prior. In the special case of single SNP association testing
and assuming Hardy-Weinberg equilibrium, it follows that V ∝
7

1
nf (1−f )

(where f represents the

allele frequency of a target SNP). As a consequence, the implicit p-value prior essentially assumes
a larger a priori effect for SNPs that are less informative (either due to a smaller sample size
or minor allele frequency). Although, from the Bayesian point of view, there seems to be a lack
of proper justification for such prior assumptions (Wakefield, 2009, Wen and Stephens, 2014),
we often note that the overall effect of the implicit p-value prior on the final inference may be
negligible in practice, especially when the sample size is large (see section 5.1.1 for illustration).

3.1.2

Connection with the variance component score statistic

In SNP set analysis, it has become common practice to construct a variance component score
test for the genetic effect β (Wu et al., 2011, Lee et al., 2012, Schifano et al., 2012). That is,
for a set of p SNPs, the genetic effects are assumed to be random and follow the distribution
β ∼ N(0, γM ), where the matrix M is pre-defined. To test H0 : γ = 0 vs. H1 : γ 6= 0, the score
−1

−1

statistic is given by Tscore = τ̃ 2 (y − X α̃)0 Σ̃ GM G0 Σ̃ (y − X α̃), where Σ̃ = I + λ̃K. In the
special case that the random effect u is ignored (i.e., λ = 0, Σ̃ = I), Tscore is reduced to the form
of the original SKAT statistic (Wu et al., 2011). By re-parameterizing W = γM , we show that
ABF(κ = 0) can be represented as a function of Tscore (Appendix C.2). In particular, as γ → 0,
it follows that
ABF(W = γM , κ = 0) ≈ exp

γ
2



Tscore .

That is, ABF(κ = 0) becomes monotonic to the variance component score statistic. Interestingly,
the condition γ → 0 represents a local alternative scenario (i.e., β only slight deviates from 0),
for which score tests are known to be most powerful.

8

4
4.1

Genetic Association Analysis with Bayes Factors
Bayesian Hypothesis Testing

Bayes factors present two major advantages in the hypothesis testing of genetic association
signals: namely, the convenience of Bayesian model averaging and the flexibility of utilizing
useful prior information. Before we delve into the details of the advantages of Bayesian models
in hypothesis testing, it is worth noting that the practical usage of Bayesian model comparison
in hypothesis testing is limited, mostly due to the difficulty involved in determining significance
thresholds based on Bayes factors. Traditionally, this issue has been addressed by treating a
Bayes factor as a regular test statistic and deriving its p-value accordingly (Good, 1992, Servin
and Stephens, 2007). Because the null distribution of a Bayes factor is generally non-trivial,
most practical implementations rely on permutation procedures. Recently, Wen (2013) proposed
a robust Bayesian false discovery rate (FDR) control procedure that directly uses the Bayes
factors as inputs. This procedure ensures FDR control, even under the mis-specification of
alternative models, a property resembling the behavior of p-value based procedures under similar
circumstances. Most importantly, this procedure is highly computationally efficient and generally
does not require extensive permutations.

4.1.1

Model Averaging

In hypothesis testing, there often exist multiple alternative scenarios, and a single parametric
model (or its corresponding test statistic) can hardly accommodate all cases. For example, in
SNP set testing of rare-variant genetic associations, there exist two primary types of competing
approaches that target different alternative scenarios. The first type, represented by the burden
tests (Madsen and Browning, 2009), collapses the genetic variants in a region to form a single
characteristic genetic unit, with respect to which the association test is then performed. This
9

approach is ideal for a particular alternative scenario in which most of the variants considered
are either consistently deleterious or consistently protective. The second type of the approach,
represented by the C-alpha (Neale et al., 2011) and SKAT tests, targets a complementary scenario
in which the variants included in the SNP set can have bi-directional effects on the phenotype
of interest. In practice, because the true alternative model is never known a priori, it remains a
challenge to reconcile/combine the results from the two distinct approaches into the frequentist
testing paradigm. Bayesian model averaging provides a principled way to naturally address
this issue. Suppose that there are k possible alternative models in consideration, and for each
model i, a Bayes factor BFi can be computed and a prior probability/weight, πi is assigned. An
P
overall Bayes factor then can be computed by BF = ki=1 πi BFi , which summarizes the overall
evidence from the data compared to the null model while accounting for the uncertainty of the
true alternative scenario.
In the context of SNP set analysis, Lee et al. (2012) showed that the alternative scenarios
considered in the burden and SKAT tests can both be represented in the LMM framework
with different specification of random effect W matrix. In brief, let the column vector w =
(w1 , ..., wp ) denote the marginal prior effect sizes for p SNPs in a set. The burden test assumes
√
√
W = W b = ( w)( w)0 , whereas the SKAT model assumes W = W s = diag(w). Given
these results and within the framework of BLMM, we can straightforwardly average the evidence
over the the two competing alternative models by computing an overall Bayes factor, BF(π) =
π · BF(W b ) + (1 − π) · BF(W s ), where the probability π denotes the relative prior frequency
of the burden model. Without prior preference over the two alternatives, a natural “objective”
choice is to set π = 0.5.
Lee et al. (2012) provided an alternative interpretation by connecting the two models. They
considered a class of W matrices indexed by a non-negative correlation coefficient ρ: namely,
√
√
W ρ = diag( w) [(1 − ρ)I + ρ110 ] diag( w) = (1 − ρ) W s + ρ W b ,
10

(4.1)

which we will refer to as the SKAT-O prior. It should be noted that the prior distribution
for β assumed by Bayesian model averaging is essentially a normal mixture, which itself is not
necessarily normal and hence differs from the SKAT-O prior. Nevertheless, the SKAT-O prior
can be viewed as a normal approximation of this mixture distribution (to the first two moments).

4.1.2

Informative Prior

The explicit specification of the prior distribution on β for alternative models is seemingly a
distinct feature of Bayesian hypothesis testing. However, as we have shown, even the most commonly applied frequentist test statistics can be viewed as resulting from some implicit Bayesian
priors. Therefore, it is only natural to regard the prior specification of β as an integrative component in alternative modeling. This fact should encourage practitioners to explicitly formulate
appropriate informative priors in Bayesian hypothesis testing: if the prior does capture some
essence of reality, it improves the overall statistical power; even if the prior is mis-specified, testing with Bayes factors using the procedures, such as either the Bayes/Non-Bayes compromise or
the robust Bayesian FDR control, only results in a reduction in power but no inflation of type I
error.
For SNP set analysis, it has become common practice to pre-define some “weight” for each
individual participating SNP in both the burden and SKAT types of approaches (i.e., the aforementioned w vector). Most commonly, these priors are set up to prioritize genetic variants with
low allele frequencies. When performing genetic association analysis, it is now becoming increasingly popular to incorporate genomic annotation and/or pathway information. In all of these
examples, BLMM provides a convenient way to formally integrate the prior information into the
hypothesis testing.
Finally, we note that there exist practical settings, especially in the studies of genome-wide scale,
in which the information of the desired priors can be sufficiently “learned” from data facilitated
11

by the Bayes factors. Take, for example, the problem of SNP set analysis with two competing
alternatives, and consider inferring the weights of the burden and the SKAT models (π) from
the data. Hypothetically, if (i) many SNP sets are investigated (in a single or multiple studies)
and (ii) a sufficient amount of modest to strong signals are presented in the data, it should be
intuitive that π can be accurately estimated by pooling the information across all SNP sets. More
specifically, for each SNP set, we can augment a latent indicator to represent the true generative
model of the observed data. Subsequently, a straightforward EM algorithm (where the complete
data likelihood can be evaluated via Bayes factors) can be used to estimate π.

4.2

Bayesian Variable Selection in the BLMM

Beyond hypothesis testing, many practical problems in genetic association studies can be tackled
using model comparison/selection techniques via Bayes factors. Here, we consider the problem
of multi-locus fine-mapping analysis. In practice, the fine-mapping analysis usually focuses on
relatively small genomic regions flagged by SNP association signals, with the aim of identifying
multiple potential signals and narrowing down the candidate causal variants within a region
while accounting for LD.
Consider a region of p candidate variants whose genetic effects are jointly modeled by the pvector β. Ultimately, we are interested in making an inference on the binary vector γ :=
(1(β1 6= 0), . . . , 1(βp 6= 0)). Under the BLMM, we assume the following spike-and-slab prior for
variable selection, namely,

2

β | γ ∼ N(0, W ) with W = φ diag (γ) , and Pr (γ) =

p
Y

pξ1i (1 − p1 )(1−ξi ) ,

(4.2)

i=1

where the parameter p1 denotes the prior inclusion probability of a SNP and the parameter
φ2 represents the prior genetic effect size of each SNP. The posterior distribution of γ can be

12

computed by

Pr(γ | φ2 , y, X, Z, G) ∝ Pr(γ) · P (y | γ, φ2 , X, Z, G) ∝ Pr(γ) · BF(W ),

(4.3)

where the Bayes factor can be further approximated by ABF(W , κ). It is then conceptually
straightforward to design an MCMC algorithm to perform Bayesian variable selection. We note
that, in the case of setting κ = 0, there are substantial computational savings in the proposed
MCMC computation. We give the detailed description and explanation of the MCMC algorithm
in Appendix D.

5
5.1

Numerical Illustration
Application of BLMM to an A. thaliana Data Set

In this example, we apply the BLMM to study the genetic associations between the genotypes
of an inbred A. thaliana line and the quantitative phenotype of sodium concentration in the
leaves using the data described in (Baxter et al., 2010). The data set consists of 336 inbred
individuals, and each individual is genotyped at 214K SNP positions genome-wide. The data
set was previously analyzed by Segura et al. (2012) under the LMM setting. We conduct an
additional quantile normalization step for the original phenotype measurements to prevent the
influence of potential outliers.

5.1.1

Single SNP Association Analysis

We first perform single SNP association tests using the approximate Bayes factors of the BLMM
and compare the results with the analyses based on p-values. To specify the alternative models
in the BLMM, we consider a natural exchangeable prior on the standardized effect scale, i.e.,
13

√
τ β ∼ N(0, φ2 ). Unlike the implicit p-value prior, this prior does not assume a relationship
between the genetic effect size and the features of a target SNP. Furthermore, instead of fixing
a single φ value, we assume φ is uniformly drawn from the set L := {φ : 0.1, 0.2, 0.4, 0.8, 1.6},
where the various levels of φ values cover a range of small, modest to large potential effect sizes.
The use of multiple φ values forms a mixture normal prior, which is helpful for describing a
longer-tailed distribution of effect sizes (Servin and Stephens, 2007, Wen, 2014). The range of
the φ values is selected following the suggestion of Stephens and Balding (2009). We use the
software package GEMMA (Zhou and Stephens, 2012) to estimate the kinship matrix, K, for
the random effect, and obtain the MLEs, β̂(λ̂), β̂(λ̃), along with their standard errors for all the
SNPs. Applying the equation (3.3), we then compute the approximate Bayes factors at κ = 1
and κ = 0 for each φi value. Finally, we compute an overall Bayes factor by averaging over all
P
1
the prior effect size models, i.e., BF = ||L||
i BF(φi ).
We first investigate the ranking of the association signals by the ABFs under the natural Bayesian
prior and the p-values based on the score and Wald test statistics. To this end, we compute the
Spearman’s rank correlation coefficient (ρ) of the log10 (ABF) and − log10 (p-value). The overall
rank correlation (from all 214K association tests) between − log10 (p-value) based on the score
statistic and log10 [ABF(κ = 0)] is 0.817. However, we note that the majority of the discordance
in ranking comes from the unlikely association signals (see Figure 1), which are generally not
of interest. Focusing on the subset of 10,913 SNPs with p-value < 0.05, the rank correlation
becomes nearly perfect (ρ = 0.995). Similarly, the − log10 (p-value) based on the Wald statistic
has an overall rank correlation of 0.821 with log10 [ABF(κ = 1)], and for the subset of 11,379 SNPs
with corresponding p-value < 0.05, ρ = 0.996. The direct comparison between the approximate
Bayes factors and corresponding p-values is shown in Figure 1.
As an illustration, we further apply the Bayesian and the frequentist FDR control procedures for
the Bayes factors and p-values to determine the significance cut-offs, ignoring correlations among
the tests. Ultimately, both the Benjamini-Hochberg and the Storey procedures using the score
14

Figure 1: Direct comparison of the ABFs and p-values on the log scale. The plot shows that
the rankings of the association signals based on the Bayes factor and the p-value are largely in
agreement, especially for SNPs showing modest to strong signs of association.

statistic p-values select 17 significant SNPs (denoted by set Sp ). In comparison, the standard
Bonferroni procedure selects 12 SNP (denoted by set Sb ). The Bayesian FDR control procedure
(i.e., the EBF procedure, described in Wen (2013)) based on ABF(κ = 0) selects 14 significant
SNPs (denoted by set SBF ). Importantly, we note that Sb ⊂ SBF ⊂ Sp . The results from the
ABF(κ = 1) and Wald statistic p-values are nearly identical.
Based on this result, we conclude that, under this particular GWAS setting with a very modest
sample size, there is no obvious practical difference in applying the Bayes factors and the p-values
in single SNP hypothesis testing. We view this result as a numerical validation of our theoretical
results discussed in section 3.1.

15

5.1.2

Fine-Mapping Analysis

Following Segura et al. (2012), we further perform a multi-locus fine-mapping analysis of a 200kb
genomic region centered around the top single SNP association signal at chr4:6392280, where
508 SNPs are included. Using the MCMC algorithm described in section 4.2, we assign the prior
inclusion probability p1 = 1/508 for each candidate SNP, which conservatively sets the prior
expected number of signals in the region to 1. Conditional on a SNP having a non-zero effect
(i.e., 1(βi ) 6= 0), we use the same normal mixture prior for the effect size βi described in the
single SNP association analysis. We obtain the posterior samples from 300,000 MCMC repeats
after 150,000 burn-in steps, and the convergence of the MCMC algorithm is diagnosed using the
procedure described in Brooks et al. (2003).
The analysis based on the posterior samples clearly indicates that there are multiple independent
association signals residing in this relatively small genomic region. There is zero probability mass
on those posterior models containing fewer than 3 SNPs; the probabilities for the posterior models
having 3, 4, 5 and 6 independent signals are 0.175, 0.452, 0.350 and 0.023, respectively. Inspecting
individual SNPs, we summarize the top five associated SNPs according to their posterior inclusion
probabilities in Table 1. The correlations among the top 5 SNPs are very modest. Thus far, our
result has been largely consistent with what is reported in Segura et al. (2012), in which a stepwise
variable selection scheme with a BIC-like model selection criteria is employed. Nevertheless,
we notice a great deal of uncertainty within the individual models from our analysis. The
details of the top 10 models ranked by their posterior probabilities are shown in Table 2. The
maximum a posterior (MAP) model only has a probability of 0.05, and all of the top models
have similar complexities and very comparable likelihoods. In addition, we find that 61% of the
posterior models contain both of the top two SNPs, and 32% of the posterior models contain a
combination of the top three SNPs. One may naturally suspect that the uncertainty in relative
large models (i.e., with more SNPs included) is partially due to the stringent p1 prior. To this

16

end, we modify the prior distribution to log10 p1 ∼ Uniform[−2.71, −1.40] (the two end points
correspond to p1 equaling 1/508 and 20/508, respectively), but the results do not qualitatively
change. Biologically, it might be the case that the true causal variants are not directly genotyped
and the observed signals are only partially correlated with them. It is then worth following up
with dense genotyping experiments or genotype imputations. Statistically, it seems evident that,
in this particular case, reporting a single “best” model from the variable selection procedure
yields an over-simplified picture and can be misleading for the follow-up analysis.
SNP
chr4:6414956
chr4:6392280
chr4:6420777
chr4:6455695
chr4:6391204

Posterior Inclusion Prob.
0.795
0.741
0.528
0.451
0.405

Marginal log10 (ABF)
4.98
7.96
6.03
5.30
7.92

Table 1: Top 5 associated SNPs according to their marginal inclusion probabilities in the
Bayesian fine-mapping analysis. The last column shows the values of log10 ABF(κ = 0) from
the single SNP association testing. Only SNP chr4:6392280 and SNP chr4:6391204 show a very
modest LD, whereas all of the other pairs of SNPs are very weak in LD.

5.2

Simulation Study of SNP Set Analysis

In this section, we perform simulation studies to illustrate the effectiveness of the proposed
Bayesian model comparison approach in SNP set analysis. In each simulated data set, we generate
5,000 phenotype-SNP set pairs that mimics the data structure from genome-wide investigation
of expression quantitative trait loci (eQTLs). We randomly select 3,500 SNP sets and simulate
their phenotypes from a null model. For the remaining SNP sets, we use two types of alternative
models described in Lee et al. (2012) to generate their phenotypes: one model assumes consistent
directional effects of rare variants, whereas the other allows inconsistent directional effects. We
use π to denote the relative frequency of the sign-consistent models in all the alternative models,
and vary this parameter in different simulation sets. We give a detailed account of the simulation

17

Model
chr4:6392280
chr4:6392280
chr4:6391204
chr4:6380552
chr4:6391204
chr4:6392280
chr4:6391286
chr4:6392280
chr4:6380552
chr4:6380552

+
+
+
+
+
+
+
+
+
+

chr4:6394774
chr4:6414956
chr4:6392280
chr4:6391204
chr4:6414956
chr4:6414956
chr4:6392280
chr4:6414956
chr4:6391204
chr4.6392280

+
+
+
+
+
+
+
+
+
+

chr4:6414956
chr4:6420777
chr4:6414956
chr4:6414956
chr4:6420777
chr4:6418442
chr4:6414956
chr4:6418442
chr4:6392280
chr4:6394774

+
+
+
+
+
+
+

chr4:6421034
chr4:6455695
chr4:6420777
chr4:6455695
chr4:6455695
chr4:6420777
chr4:6420777

+ chr4:6420777
+ chr4:6414956 + chr4:6421034

Posterior Prob.
0.052
0.039
0.032
0.028
0.026
0.024
0.022
0.018
0.017
0.016

log10 (ABF)
19.55
18.89
18.47
18.67
18.72
18.68
18.35
16.75
18.19
21.25

Table 2: Top 10 posterior models in the Bayesian fine-mapping analysis. The models are
ranked according to their posterior probabilities (second column). The last column shows the
values of log10 ABF(κ = 0) of the corresponding models. Our prior specification encourages
sparse models: complicated models with more predictors are penalized more severely by the
prior inclusion probability. The most important feature of these results is that there is not a
unique simple model that is clearly better than the others.

schemes in Appendix E.1.
We analyzed the simulated data sets using the proposed Bayesian model comparison approach
and the SKAT-O method implemented in the R package SKAT (version 0.95) to examine their
controls of FDR and powers. For both approaches, we again follow the previous work (Wu et al.,
2011, Lee et al., 2012) and assign the marginal weight for each SNP as a function of their allele
frequencies. In Bayesian analysis, we apply two strategies in choosing the prior weights for Bayes
factor computation. The first strategy assumes an “objective” uniform prior setting π = 0.5,
and the second strategy estimates π and the distribution of genetic effect sizes from the data by
pooling information across all phenotype-SNP set pairs using a hierarchical model. The details
of the analysis procedure are provided in Appendix E.2.
We summarize the simulation results in Table 3. The false discovery rates in all the methods
are well controlled. The performance of the Bayesian procedure with the default uniform prior
weights is very similar to that of the SKAT-O, and the Bayesian procedure based on informative
priors achieves the best power in all settings defined by different true π values. These results are
well expected because the Bayesian method with estimated weights has the unique advantage of
18

Setting (π)
0.20
0.40
0.50
0.60
0.80

SKAT-O
0.024
0.046
0.051
0.049
0.050

FDR
Bayesian-D
0.027
0.030
0.045
0.046
0.049

Bayesian-E
0.023
0.028
0.041
0.045
0.048

SKAT-O
0.768
0.791
0.836
0.909
0.933

Power
Bayesian-D
0.741
0.773
0.825
0.908
0.943

Bayesian-E
0.821
0.828
0.869
0.919
0.948

Table 3: Realized false discovery rate and power in simulation studies of SNP set analysis. The
first column (setting) indicates the percentage of the SNP sets with sign-consistent effects among
all of the non-null SNP sets in the simulated data. For the SKAT-O procedure, the resulting pvalues are further processed by the Storey procedure for FDR controls. “Bayesian-D” indicates
the Bayesian testing procedure with the default uniform weights. ”Bayesian-E” indicates the
Bayesian procedure that estimates π from the data. The FDR control for the Bayes factors is
performed using the EBF procedure described in Wen (2013).

effectively borrowing information across genes through the use of Bayes factors and hierarchical
modeling. In addition, we want to emphasize that all of the Bayesian models assumed in the
analysis are indeed very “wrong” comparing to the true data-generating model; nevertheless, the
robust Bayesian FDR control procedure using Bayes factors ensures the targeted FDR level.
Going beyond SNP set testing targeting rare variant associations, in Appendix F, we further
demonstrate that our Bayesian model averaging framework can be conveniently extended to
integrate models for detecting common variant associations into SNP set testing. We envision
that this approach will have a profound impact in studies of expression trait quantitative loci at
genome-wide scale.

6

Discussion

In this paper, we have presented a unified Bayesian framework to perform model comparisons
in the contexts of a linear mixed model and SNP set analysis. Although our statistical results
are presented exclusively for the quantitative response variables, it is possible to extend them to
the generalized linear mixed models (GLMM) context to incorporate binary outcomes and count
19

data using a quadratic approximation of the corresponding log-likelihood functions.
Primarily based on the results of the approximate Bayes factors, we have demonstrated an efficient Bayesian sparse variable selection algorithm to perform multi-locus association analysis
using the BLMM. Recently, Zhou et al. (2013) also proposed an elegant Bayesian solution for
multiple SNP association analysis under the LMM model on the genome-wide scale. It should
be noted that their method also has a primary focus on estimating the heritability, whereas our
method is designed for fine-mapping analysis. In addition, by treating SNP sets as selection
units, our approach can be straightforwardly extended to the identification of multiple associated genes/SNP sets, which may be attractive for biological pathway analysis. Previous studies
(Guan et al., 2011, Wen, 2014) have shown that Bayesian methods generally hold advantages over
penalized regression approaches in variable selection problems with correlated covariates (e.g.,
SNPs in LD) and/or non-i.i.d. residual error structures. More importantly, as we have demonstrated, there can be great uncertainty regarding any single “best fitting” model. As a practical
consequence, reporting a single “best” model but ignoring appropriate uncertainty assessments
could hinder follow-up scientific investigation.
Finally, we want to note that Bayesian model comparison approaches have been successfully
assessed in other areas of genetic association studies, e.g., meta-analysis (Wen and Stephens,
2014), association mapping of multiple-traits and detecting gene-environment interactions (Flutre
et al., 2013, Wen and Stephens, 2014). Our results can be conveniently integrated into those
existing tools, and their usages can be naturally extended to incorporate LMM and SNP set
analysis.

20

7

Supplementary Material

The software, scripts used to generate simulated data can be found at http://github.com/
xqwen/BLMM. Detailed derivations, proofs and descriptions of relevant algorithms and simulation
details are included in the supplementary file.

Acknowledgments
We thank Seunggeun Lee and Xiang Zhou for helpful discussions. This work is supported by
NIH grants R01-MH101825 and R01-HG007022.

21

A

Bayes Factor Derivation

In this section, we show the detailed derivation of the approximate Bayes factors under the
BLMM, which also serves as a proof for Proposition 1 in the main text.

A.1

Exact Bayes factor with known λ and τ

We first consider the case where the variance parameters τ and λ are known, instead of being
assigned priors. In this case, we show that the exact Bayes factor under the BLMM can be
analytically computed. We summarize this result in the following lemma:
LEMMA 1. Under the BLMM, if the variance parameters τ and λ are known, the Bayes factor
can be analytically computed by

BF(W ) = |I + V̂

−1

− 21

W|


· exp

i −1 
−1
1 0 −1 h
−1
β̂ V̂
W (I + V̂ W )
V̂ β̂ .
2

(A.1)

Proof. The linear mixed model can be equivalently represented by
y = Xα + Gβ + ,

 ∼ N 0, τ −1 Σ ,

(A.2)

where Σ = I + λK. With the variance parameters and Σ known, we perform the following
transformations to the observed data:
1

y = Σ− 2 y
e
1
X = Σ− 2 X
f
1
G = Σ− 2 G
e

(A.3)

22

This results in a linear model
y = X α + G β + ,
e
e
e f

−1
 ∼ N 0, τ I ,
e

(A.4)

1

where  = Σ− 2 . Linear model (A.4) is a trivial special case of the complex linear model systems
e
considered by Wen (2014). Consequently, it follows from the Lemma 1 of Wen (2014), given the
prior specifications described in the main text, the Bayes factor can be analytically computed by

BF(W ; λ, τ ) = |I + V̂

−1

− 12

W|


· exp

i −1 
−1
1 0 −1 h
−1
β̂ V̂
W (I + V̂ W )
V̂ β̂ .
2

(A.5)

Next, we show the detailed analytic forms of β̂ and V̂ under the BLMM. First, we define


Gx = I − Σ

−1/2

0

−1

X XΣ X

−1

0

XΣ

−1/2



Σ−1/2 G,

(A.6)

which only depends on λ through Σ. It follows that

β̂(λ) = (G0x Gx ) G0x Σ−1/2 y,

(A.7)

and
−1

V̂ (λ, τ ) = τ −1 (G0x Gx )

.

(A.8)

23

A.2

Approximate Bayes factors for unknown λ and τ

When λ and τ are unknown, to compute the Bayes factor, it is required to evaluate the following
marginal likelihood
Z
p(y | W , X, G, Z) =

p(y | W , X, G, Z, λ, τ )p(λ, τ )dλdτ,

(A.9)

and the desired Bayes factor is therefore computed as
R

p(y | W , X, G, Z, λ, τ )p(λ, τ )dλdτ
R
BF(W ) = lim
.
Ψ−1 →0 p(y | W = 0, X, G, Z, λ, τ )p(λ, τ )dλdτ

(A.10)

By applying the Bounded convergence theorem (to switch limit and integration), we can carry
the analytic computation up to the following point
R
KHa dλdτ
BF(W ) = R
,
KH0 dλ dτ

(A.11)

where
1

KHa = |I + V̂ (τ, λ)−1 W (τ, λ)|− 2


h
i−1
1
0
−1
−1
−1
· exp
β̂(λ) V̂ (τ, λ) W (τ, λ) I + V̂ (τ, λ) W (τ, λ)
V (τ, λ) β̂(λ)
2
 τ

n
0
− 12
−1
2
· τ |Σ(λ)| p(λ, τ ) · exp − [y − X α̃(λ)] Σ(λ) [y − X α̃(λ)] ,
2

(A.12)

 τ

1
n
KH0 = τ 2 |Σ(λ)|− 2 p(λ, τ ) · exp − [y − X α̃(λ)]0 Σ(λ)−1 [y − X α̃(λ)] ,
2

(A.13)

and

where

α̃(λ) = (X 0 Σ−1 X)−1 X 0 Σ−1 y.

(A.14)
24

We propose to approximate the double integrals of both KHa and KH0 by Laplace’s method. In
general, Laplace’s method approximates a multiple integral with respect to a p-vector z in the
following fashion,
Z
D

h(z) exp [g(z)] dz ≈ (2π)p/2 |H ẑ |h(ẑ) exp [g(ẑ)] ,

(A.15)

where

ẑ = arg max g(z),
z
and |H ẑ | is the absolute value of the determinant of the Hessian matrix of the function g
evaluated at ẑ. There may be multiple choices to factor an integrand into functions h and g, the
technical requirements for a valid asymptotic approximation are

1. h is smooth and positively valued
2. g is smooth and obtains its unique maximum (w.r.t z) in the interior of D
3. g is linear increasing with respect to the sample size n

Different factorization schemes satisfying above requirements usually yield different approximation accuracies for finite sample size, nonetheless, their asymptotic error bounds are the same.
For a detailed discussion, see Butler (2007) chapter 2.
We apply a specific factorization for KHa and KH0 for Laplace’s method. First, we note the
decomposition of the quadratic form
τ [y − X α̃(λ)]0 Σ(λ)−1 [y − X α̃(λ)]
h
i0
h
i (A.16)
−1
−1
= β̂(λ)V̂ (τ, λ) β̂(λ) + τ y − X α̂(λ) − Gβ̂(λ) Σ(λ)
y − X α̂(λ) − Gβ̂(λ) ,

25

where




−1
 α̂  
0 −1
(X G)0 Σ−1 y.

 = (X G) Σ (X G)
β̂

(A.17)

Thus, for an arbitrary weight parameter κ ∈ [0, 1], we can write
τ [y − X α̃(λ)]0 Σ(λ)−1 [y − X α̃(λ)]

h
i0
h
i
−1
−1
= κ · β̂(λ)V̂ (τ, λ) β̂(λ) + τ y − X α̂(λ) − Gβ̂(λ) Σ(λ)
y − X α̂(λ) − Gβ̂(λ)
+ (1 − κ) · τ [y − X α̃(λ)]0 Σ(λ)−1 [y − X α̃(λ)]
(A.18)

Using this decomposition, we factor KHa into KHa = ha (λ, τ ) exp[ga (λ, τ )], where
1

ha (λ, τ ) = |I + V̂ (τ, λ)−1 W (τ, λ)|− 2


h
i−1
1
0
−1
−1
−1
β̂(λ) V̂ (τ, λ) W (τ, λ) I + V̂ (τ, λ) W (τ, λ)
V (τ, λ) β̂(λ)
· exp
2

 κ
· exp − β̂(λ)V̂ (τ, λ)−1 β̂(λ) · p(λ, τ )
2

(A.19)

and

n
1
τ
log(τ ) − log |Σ(λ)| − (1 − κ) [y − X α̃(λ)]0 Σ(λ)−1 [y − X α̃(λ)]
2 
2
2
(A.20)
h
i0
h
i
τ
−1
− κ y − X α̂(λ) − Gβ̂(λ) Σ(λ)
y − X α̂(λ) − Gβ̂(λ) .
2

ga (λ, τ ) =

We factorize into KH0 = h0 (λ, τ ) exp[g0 (λ, τ )], where
 κ

h0 (λ, τ ) = exp − β̂(λ)V̂ (τ, λ)−1 β̂(λ) · p(λ, τ ),
2
and g0 (λ, τ ) = ga (λ, τ ).

26

(A.21)

Note that for any given λ value, there is a corresponding τ value, namely,

τ̂ (λ; κ) = n

(1 − κ)[y − X α̃(λ)]0 Σ(λ)−1 [y − X α̃(λ)]


+ κ[y − X α̂(λ) − Gβ̂(λ)] Σ(λ) [y − X α̂(λ) − Gβ̂(λ)] ,
0

(A.22)

−1

maximizes the ga (λ, τ ) among all possible τ values. Consequently, maximizing function ga (λ, τ )
is equivalent to maximize ga (λ, τ̂ (λ)) with respect to the single parameter λ. Therefore, we can
simplify the target objective function to

l(λ; κ) =

1
n
log τ̂ (λ) − log |Σ(λ)|.
2
2

(A.23)

It should be noted that as in the special cases κ = 1 and κ = 0, the objective function (A.23)
becomes the score functions of the full and null LMMs, respectively. In general, there is no strong
guarantee that the function (A.23) is strictly concave with respect to λ. Nevertheless, the second
derivative of l(λ; κ) (not shown, see Zhou and Stephens (2012) for reference) suggests that the
objective function is asymptotically concave (i.e., concave for sufficiently large sample size n).
There is no analytic solution to optimize (A.23), and the gradient based numerical optimization
algorithms, e.g. the Newton-Raphson method, are typically applied in this setting (because the
derivatives of the objective functions can be efficiently evaluated, as demonstrated in Zhou and
Stephens (2012)). We denote

λ̌(κ) = arg max l(λ; κ),

(A.24)

τ̌ = τ̂ (λ̌).

(A.25)

λ

and

27

Based on (A.15), Laplace’s method yields the following approximation to the Bayes factor
1

BF(W ) = |I + V̂ (τ̌ , λ̌)−1 W (τ̌ , λ̌)|− 2


h
i−1
1
−1
−1
0
−1
· exp
β̂(λ̌) V̂ (τ̌ , λ̌) W (τ̌ , λ̌) I + V̂ (τ̌ , λ̌) W (τ̌ , λ̌)
V (τ̌ , λ̌) β̂(λ̌) (A.26)
2

 
1
.
· 1+O
n
This essentially proves Proposition 1.

B

Numerical Accuracy of Approximate Bayes Factors

The proposition 1 shows that the approximate Bayes factors under the BLMM have an O(1/n)
error bound for κ ∈ [0, 1]. In this section, we perform numerical experiments to investigate
impacts of different values of κ and n on the accuracy of the approximations. To this end, we
sub-sample the real genotype and phenotype data from the A. thaliana example to obtain 3,000
SNPs at various sample sizes: n = 50, 100, 150, 336. For each sub-sampled data set, we compute
the ABFs for κ = 0 and 1 based on the output from GEMMA using equation (3.7) in the main
text.
In comparison, we compute the Bayes factors by numerical integration. For general prior p(λ, τ ),
the two-dimensional numerical integration is practically implausible. (Although Monte Carlo integration is possible, we find the results typically exhibit extremely large variances.) To overcome
this difficulty, we apply a specific form of prior,

p(λ, τ ) = p(λ)p(τ ) ∝

1 1
,
λτ

i.e., the priors of λ and γ are independent, p(τ ) is assumed a limiting gamma distribution and p(λ)
is assumed a limiting inverse-gamma distribution. With this specification, it becomes possible to
28

first integrate out τ analytically conditional on γ and then perform a one-dimension numerical
integration with respect to γ using the adaptive Gaussian quadrature algorithm implemented in
R. It is worth emphasizing that in this exercise, the statistical interpretation of the priors or the
resulting Bayes factors is unimportant, we simply attempt to evaluate the numerical differences
by different Bayes factor computation methods.
The comparison results for different sample sizes and κ values are summarized in Figure 2.
Regarding the results from the numerical integrations as the “truth”, we find that for relatively
small sample sizes, ABF(κ = 0) tends to be slightly conservative while ABF(κ = 1) tends to
be slightly anti-conservative. However, when the sample size grows ∼ 300, both approximations
become quite accurate.

C
C.1

Connection between Bayes factor and score statistic
Connection with fixed effect score statistic

In this section, we give the mathematical details on connections between the approximate Bayes
factor evaluated at κ = 0 and the fixed effect score test statistics. In particular, it is sufficient
to show that the quadratic form β̂(λ̃)V̂ (λ̃, τ̃ )−1 β̂(λ̃) corresponds to the score statistic for testing
the fixed effect β = 0.
To see this, we relate β̂(λ) to α̃(λ), the MLE of α estimated under the null model restriction
β = 0. The expression of α̃(λ) is given in (A.14), and it can be shown that

β̂(λ) = Q(λ)G0 Σ(λ)−1 [y − X α̃(λ)] ,

(C.1)

29

0.0

0.5

1.0

1.5

2.0

●
●

●

●●
●
●
●
●
●
● ●●
● ●
●●●
●● ●
●●
●
●
●
●
●
●
●
●
●
●
●● ●
●●
●
●
●
● ●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●●
●
● ●
●
●
●
●
●
●● ●
●●
●●●
●
●
●
●
● ●●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

−0.5

0.0

0.5

1.0

1.5

2.0

(a) sample size n = 50

(b) sample size n = 100

−0.5

0.0

0.5

1.0

1.5

2.0

2.5

2.0
1.0

●
●●
●
●
●

0.0

●●
●
●●
●●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●●●
●
●
●
●
●●
●●
●
●
●
●
● ●●
● ●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
● ●● ●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

●
●
●
●

●

−1.0

●
●
●
●

κ=1
κ=0

log10(BF) by numerical integration

2.5

●
●
●

●
●

0.5

●
●
●

log10(ABF) by analytic approximation

●

1.5

2.0

●

●

κ=1
κ=0

log10(ABF) by analytic approximation

●

−0.5

1.5

●●

1.0

●
●
●●●
●
●
●
●
●●
●
●●
●
●
●
●●●
●
● ●●
●
●● ●
●
●
●
●
●
●
●●
● ● ●
●
●
● ●●●
●
●
●●
●●
●●
●
●●
●
●
●●
●●
●
●●●
●
●●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

●

0.5

●
●
●

0.0

●●

●

●

−0.5

●

●
●

κ=1
κ=0

−0.5

log10(BF) by numerical integration

log10(BF) by numerical integration

2.0
1.5
1.0
0.5
0.0
−0.5

log10(BF) by numerical integration

●

●

●
●

κ=1
κ=0

●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

−1.0

0.0

0.5

●
●●
●●
●
●
●●
●●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●

1.0

●●
●●●
●
●
●
●
●

1.5

●
●
●●
●●

●
●

2.0

log10(ABF) by analytic approximation

log10(ABF) by analytic approximation

(c) sample size n = 200

(d) sample size n = 336

2.5

Figure 2: approximation accuracy by different sample sizes. In each panel, we plot the “true”
values of log10 BF evaluated by numerical integration against their analytic approximations with
different κ values. For small sample sizes, ABF(κ = 1) tends to be anti-conservative while
ABF(κ = 0) tends to be conservative comparing to the truth. Nevertheless, as the sample size
grows, both become accurate.
where

−1
Q(λ) = G0 Σ(λ)−1 G − G0 Σ(λ)−1 X(X 0 Σ(λ)−1 X)−1 X 0 Σ(λ)−1 G
.

30

(C.2)

Furthermore,

V̂ (λ, τ ) = τ −1 Q(λ)−1 .

(C.3)

Therefore, it follows that

V̂

−1

(λ, τ )β̂(λ) = τ G0 Σ(λ)−1 (y − X α̃(λ)) .

(C.4)

For λ = λ̃ and τ = τ̃ and noting the notations
α̃ = α̃(λ̃),
(C.5)

Σ̃ = Σ̃(λ̃),
Q̃ = Q̃(λ̃),
the desired quadratic form β̂(λ̃)V̂ (λ̃, τ̃ )−1 β̂(λ̃) can be equivalent represented by
h −1
i
−1
τ̃ (y − X α̃)0 Σ̃ GQ̃G0 Σ̃
(y − X α̃).

(C.6)

It can be trivially derived from the first principle to show that expression (C.6) is indeed the
score statistic under the LMM ((2.1) in main text) for testing the fixed effect β = 0.
Alternatively, we denote a projection matrix

P̃x = I − Σ̃

−1/2

−1

X(X 0 Σ̃ X)−1 X 0 Σ̃

−1/2

,

(C.7)

and define

X̃ G = G0 Σ̃

−1/2

P̃x .

(C.8)

31

We can further re-write (C.6) by


0

−1/2

τ̃ (y − X α̃) Σ̃

h
i  −1/2

0
0
−1
(y − X α̃) .
X̃ G (X̃ G X̃ G ) X̃ G Σ̃

(C.9)

h
i
0
0
Note, matrix X̃ G (X̃ G X̃ G )−1 X̃ G is also a projection matrix, and the results by Chen (1983)
indicate the above expression is indeed the desired score statistic.

C.2

Connection with variance component score statistic

The derivation of the score statistic based on LMM can be found in Chen et al. (2013). Consider
κ = 0 and write W = γM . Under certain convergence condition (which typically requires the
magnitude of γ is bounded), it follows from the Neumann series expansion that


−1

I + γ V̂ (τ̃ , λ̃) M

−1

=

∞
X


n
(−γ)n V̂ (τ̃ , λ̃)−1 M .

n=0

Combining the above expression with (C.4),
h
i−1
β̂(λ̃)0 V̂ (τ̃ , λ̃)−1 (γM ) I + V̂ (τ̃ , λ̃)−1 (γM )
V (τ̃ , λ̃)−1 β̂(λ̃)
−1

−1

= γ τ̃ 2 (y − X α̃)0 Σ̃ GM G0 Σ̃
+

∞
X

(y − X α̃)


n
(−γ)n+1 β̂(λ̃)0 V̂ (τ̃ , λ̃)−1 M V̂ (τ̃ , λ̃)−1 M V (τ̃ , λ̃)−1 β̂(λ̃)

(C.10)

n=1

= γTscore + γ

2

∞
X


n+1
(−γ)n β̂(λ̃)0 V̂ (τ̃ , λ̃)−1 M V̂ (τ̃ , λ̃)−1 M
V (τ̃ , λ̃)−1 β̂(λ̃)

n=0

As γ → 0, it follows that


−1

I + γ V̂ (τ̃ , λ̃) M

−1

= I − γ V̂ (τ̃ , λ̃)−1 M + O(γ 2 ),

32

(C.11)

and

ABF(W = γM , κ = 0) = exp

D

γ
2




Tscore · 1 + O(γ) .

(C.12)

MCMC algorithm for variable selection in BLMM

Wen (2014) provided an efficient MCMC algorithm to perform Bayesian variable selection in a
very general complex linear model system. In the special case of a multiple linear regression
model, their model selection formulation is almost identical to what we have described in section
4.2 of the main text, except when computing (approximate) Bayes factors, Wen (2014) assumes
i.i.d residual errors and considers no random effect.
Using the notations of (C.5), we note the BLMM induces a standard multiple linear regression
1

model on the transformed response variable, y = Σ− 2 y, and transformed covariates, X =
f
e
− 12
− 12
Σ X, G = Σ G. In particular, it is easy to see that, for arbitrary ξ(β), the approximate
e
Bayes factors evaluated at κ = 0 have identical values using either the original data (y, X, G)
or the transformed data (y , X , G), substituting Σ̃ for Σ. However, the induced linear model
e f e
of the transformed data satisfies the requirement by the Metropolis-Hastings (M-H) algorithm
described in Wen (2014), i.e., i.i.d residual errors and no random effects.
In practice, we implement the following algorithm to perform variable selections in the BLMM
using the approximate Bayes factors for κ = 0.
1. Fit the null model and obtain λ̃.
2. Compute Σ̃ and transform the observed data (y, X, G) to (y , X , G).
e f e
3. Apply the M-H algorithm of Wen (2014) on the transformed data set.
The first step can be achieved by applying the software packages EMMAX (Kang et al., 2010)
33

or GEMMA (Zhou and Stephens, 2012). The third step is implemented in the software package
SBAMS (Wen, 2014). To ensure ABF(κ = 0) is faithfully computed, it is required to set “-abf
0” option in SBAMS to estimated and use τ̃ for all values of ξ(β).

E

SNP set Simulation

In this section, we give the details of simulation schemes and parameters settings used in analysis.

E.1

Simulation Details

Our simulation scheme closely follows what is described in Lee et al. (2012). For each simulated
data set, we consider 5,000 non-overlapping SNP sets, with 1,000 SNPs in each set. For each
SNP set, we simulate the genotypes of 2,000 individuals from a calibrated coalescent model
(Schaffner et al., 2005), and the resulting LD structure within each SNP set mimics the LD
patterns observed in European ancestry samples. For 3,500 out of 5,000 SNP sets, we simulate
phenotypes from the null linear model

y = 0.5x + e, e ∼ N(0, I),

(E.1)

where x is a vector of a continuous covariate generated from N(0, 1). The phenotypes of the
remaining 1,500 SNP sets are simulated from the following linear model,

y = 0.5x +

X

βi g i + e, e ∼ N(0, I),

(E.2)

i

by two different schemes. Both schemes assume 20% of the SNPs in each SNP set are causal,
and following Lee et al. (2012), the effect size of each causal SNP is generated from the function
βj = c| log10 (mj )|, where mj is the minor allele frequency (MAF) of the assumed casual SNP.
34

The two schemes differ in the choice of the parameter c. The first scheme assumes that all causal
mutations are consistently deleterious by setting c = 0.1 as a constant, and the second scheme
assumes 40% of the causal effects are protective by setting c = −0.1 and the rest of the 60%
causal mutations are deleterious by setting c = 0.1. We vary the frequency of the sign-consistent
alternative model (π) from 0.20 to 0.80. For each π value, we simulate 10 independent data sets.

E.2

Analysis Details

Following Lee et al. (2012), we assume the same marginal weight vector, w, for SNPs in a
SNP set in both SKAT and burden models. More specifically for each SNP j, we assign wj =
Beta(MAFj , 1, 25), where MAFj denotes the minor allele frequency of the j-th SNP. Additionally
for Bayesian analysis, we explicitly account for π in our analysis, i.e., conditional on H0 is false,
we assume that with probabilities π and 1 − π the data are generated from the burden model and
P
SKAT model, respectively. We further re-normalize the marginal weights such that j wj = 1
and construct the priors on the standardized effect scale. More specifically, for the burden model,
√
√
we assume W b = τ −1 φ2 ( w)( w)0 , and for the SKAT model, W s = τ −1 φ2 diag(w). Under this
normalized weighting formulation, the value of φ measures the prior overall magnitude of signalnoise ratio at the set level. When computing the Bayes factors for both the burden and SKAT
models, we consider a grid of φ values uniformly drawn from the set {φ : 0.1, 0.2, 0.4, 0.8, 1.6}.
We apply two different strategies in choosing the prior weights for computing Bayes factors.
The first strategy simply assumes π = 12 . Alternatively, we estimate π using an EM algorithm
implemented in (Flutre et al., 2013) by pooling all the SNP sets together. We then directly use
the resulting Bayes factors and apply the FDR control procedure described in (Wen, 2013) to
perform hypothesis testing. For comparison, we apply the SKAT-O procedure (Lee et al., 2012)
and obtain the optimal p-value for each gene; then, we apply the Storey procedures to control
FDR.

35

F

Incorporating Detection of Common Variant Associations in SNP Set Testing

Historically, the development of statistical methodology for SNP set testing is mostly motivated
by detection of rare genetic variant associations. Most recently, the study of expression quantitative trait loci (eQTLs) prompts integrating the ability of detecting both common and rare
variant association signals into a unified SNP set analysis. More specifically, in eQTL analysis,
the first line of the questions is to identify genes whose expression levels are regulated by either
common or rare genetic variants (such genes are commonly referred to as eGenes). Most eGene
detection approaches focus on the genomic region near the transcription start site of each target
gene, i.e., the cis regulatory region. The SNPs within each region naturally form a candidate
SNP set for each target gene.
In the past, most eQTL studies have limited sample sizes and generally offer little power to
detect rare variant associations. As a consequence, most statistical methods for eGene detection,
frequentist or Bayesian, aim to identify genes harbor common variant associations. But this
is changing, many ongoing studies, e.g. the ongoing NIH GTEx project (http://commonfund.
nih.gov/GTEx/), start collecting data with the sample size capable of discovering rare variant
associations. In this section, we demonstrate that our Bayesian model averaging framework can
efficiently combine existing approaches for testing both rare and common variant associations in
SNP set testing for more powerful eGene discovery.

F.1

Bayesian Testing of Common Variant Associations in SNP Set

The Bayesian approaches for testing common variant associations in SNP sets have been proposed
and applied in Servin and Stephens (2007), Flutre et al. (2013). Here we extend their results
into the context of BLMM.
36

Under the formulation of BLMM, to test against the null hypothesis, H0 : β = 0, we consider a
specific class of alternative scenarios: exactly one variant in a set of p candidate SNPs is truly
associated (Servin and Stephens, 2007, Flutre et al., 2013). Consequently, there are p different
alternative models in total for a given SNP set. Based on this simplifying assumption, without
further information to distinguish the SNPs, we assign a discrete uniform prior to each SNP as
the associated SNP. We average over all p alternative models and obtain the following Bayes
factor for the SNP set
p

BFcv =

1X
BF(W i ), W i = φ2 diag(γ i )
p i=1

(F.1)

where γ i represents a p-dimensional binary indicator vector with only the i-th entry setting to
1. Clearly, each sepcification of W i corresponds to an alternative single SNP association model,
and each BF(W i ) can be simplified to the form of equation (3.7) in the main text.
It should be noted that the above alternative modeling approach is effective in identifying SNP
set harboring common variant associations as demonstrated by Servin and Stephens (2007),
but it has very little power for rare variant testing. It has been shown (Wen, 2013) that the
above Bayesian approach has similar power comparing to the frequentist approach that takes the
minimum single SNP association p-value as the test statistic for SNP set association.

F.2

Combined Bayesian SNP Set Testing of Common and Rare Variant Associations

Based on the discussion in section F.1, it is straightforward to formulate a Bayesian SNP set
testing by averaging over three types of alternative models: burden, SKAT and the common

37

variant (CV) models. A SNP set Bayes factor can be computed by

BF = πb BFburden + πs BFskat + πc BFcv ,

(F.2)

where πb , πs and πc denote the relative frequency of burden, SKAT and CV models in alternative settings. Although the default objective prior πb = πs = πc =

1
3

serves as a reasonable

starting point, in typical eQTL studies, it is highly plausible to estimate these quantities using
a hierarchical model by pooling information across genes genome-wide.
In comparison, to the best of our knowledge, there is no existing frequentist SNP set testing
approach that is optimally designed for detecting both common and rare variant associations in
a computationally efficient way.

F.3

Extended Simulation Studies

We perform additional simulation studies to demonstrate the power of the proposed Bayesian
SNP set testing approach. Particularly, in addition to the schemes that simulate sign-consistent
and sign-inconsistent multiple rare variant associations, we simulate a third type of alternative
scenario where common variants drive the genetic associations. More specifically, we simulate
according to the following linear model

y = 0.5x +

X

βi g i + e, e ∼ N(0, I),

(F.3)

i∈S

where S denote a set of either one, two or three SNPs whose allele frequencies ≥ 0.05. For each
i ∈ S, we randomly draw βi from the distribution N(0, 1).
In each simulated data set, we still consider 5,000 SNP sets where 2,500 are simulated from the
null model. For the remaining 2,500 SNP sets, we simulate the phenotypes using the three types

38

of alternative models according to a pre-defined parameter π = (π1 , π2 , π3 ), where π1 , π2 and
π3 denote the relative frequency of sign consistent model, sign inconsistent model and common
variant model (F.3), respectively. We vary π values to generate different simulated data sets.
To analyze the simulated data set, we estimate (πb , πs , πc ) using the same hierarchical model
employed in the rare variants SNP set testing and compute the Bayes factor based on (F.2). For
comparison, we compute the SKAT-O p-values for each SNP set. We again examine the FDR
control and power for each analysis method.
The results from those additional simulation studies are summarized in Table 4. All experimented methods control FDR at the desired level. Interestingly, we find both burden and SKAT
models have decent power in detecting SNP sets harboring common variant associations, which
is reflected by the overall good performance of the SKAT-O approach. Nevertheless as expected,
by explicitly targeting and modeling all possible alternative scenarios, the Bayesian approach
yield substantially higher power.
Setting (π)
(0.25, 0.35, 0.40)
(0.25, 0.25, 0.50)
(0.25, 0.15, 0.60)
(0.20, 0.10, 0.70)
(0.10, 0.15, 0.75)

SKAT-O
0.046
0.041
0.050
0.047
0.042

FDR
Bayesian-E
0.044
0.042
0.049
0.048
0.042

Power
SKAT-O Bayesian-E
0.831
0.921
0.815
0.917
0.799
0.904
0.789
0.873
0.757
0.872

Table 4: Realized false discovery rate and power in extended simulation studies of SNP set analysis.
The first column (setting) indicates the distribution of SNP sets simulated by sign-consistent, signinconsistent, and common variant association models. For the SKAT-O procedure, the resulting p-values
are further processed by the Storey procedure for FDR controls. The Bayesian approach (”Bayesian-E”)
estimates π from the data and compute the Bayes factor for each SNP set according to (F.2). The FDR
control for the Bayes factors is performed using the EBF procedure described in Wen (2013).

39

References
Baxter, I., Brazelton, J. N., Yu, D., et al. (2010). A coastal cline in sodium accumulation in
arabidopsis thaliana is driven by natural variation of the sodium transporter athkt1; 1. PLoS
genetics, 6(11), e1001193.
Brooks, S., Giudici, P., and Philippe, A. (2003). Nonparametric convergence assessment for
mcmc model selection. Journal of Computational and Graphical Statistics, 12(1), 1–22.
Butler, R. W. (2007). Saddlepoint approximations with applications. Cambridge University Press.
Chen, C.-F. (1983). Score tests for regression models. Journal of the American Statistical
Association, 78(381), 158–161.
Chen, H., Meigs, J. B., and Dupuis, J. (2013). Sequence kernel association test for quantitative
traits in family samples. Genetic Epidemiology, 37(2), 196–204.
Flutre, T., Wen, X., Pritchard, J., and Stephens, M. (2013). A statistical framework for joint
eqtl analysis in multiple tissues. PLoS genetics, 9(5), e1003486.
Good, I. (1992). The bayes/non-bayes compromise: A brief review. Journal of the American
Statistical Association, 87(419), 597–606.
Guan, Y., Stephens, M., et al. (2011). Bayesian variable selection regression for genome-wide
association studies and other large-scale problems. The Annals of Applied Statistics, 5(3),
1780–1815.
Kang, H. M., Sul, J. H., Service, S. K., et al. (2010). Variance component model to account for
sample structure in genome-wide association studies. Nature genetics, 42(4), 348–354.
Lee, S., Wu, M. C., and Lin, X. (2012). Optimal tests for rare variant effects in sequencing
association studies. Biostatistics, 13(4), 762–775.

40

Madsen, B. E. and Browning, S. R. (2009). A groupwise association test for rare mutations using
a weighted sum statistic. PLoS genetics, 5(2), e1000384.
Neale, B. M., Rivas, M. A., Voight, B. F., et al. (2011). Testing for an unusual distribution of
rare variants. PLoS genetics, 7(3), e1001322.
Schaffner, S. F., Foo, C., Gabriel, S., et al. (2005). Calibrating a coalescent simulation of human
genome sequence variation. Genome research, 15(11), 1576–1583.
Schifano, E. D., Epstein, M. P., Bielak, L. F., et al. (2012). Snp set association analysis for
familial data. Genetic epidemiology, 36(8), 797–810.
Segura, V., Vilhjálmsson, B. J., Platt, A., et al. (2012). An efficient multi-locus mixed-model
approach for genome-wide association studies in structured populations. Nature genetics,
44(7), 825–830.
Servin, B. and Stephens, M. (2007). Imputation-based analysis of association studies: candidate
regions and quantitative traits. PLoS genetics, 3(7), e114.
Stephens, M. and Balding, D. J. (2009). Bayesian statistical methods for genetic association
studies. Nature Reviews Genetics, 10(10), 681–690.
Wakefield, J. (2009). Bayes factors for genome-wide association studies: comparison with pvalues. Genetic epidemiology, 33(1), 79–86.
Wen, X. (2013). Robust bayesian fdr control with bayes factors. arXiv preprint arXiv:1311.3981 .
Wen, X. (2014). Bayesian model selection in complex linear systems, as illustrated in genetic
association studies. Biometrics, 70(1), 73–83.
Wen, X. and Stephens, M. (2014). Bayesian methods for genetic association analysis with heterogeneous subgroups: from meta-analyses to gene-environment interactions. Annals of Applied
Statistics, 8(1), 176–203.
41

Wu, M. C., Lee, S., Cai, T., et al. (2011). Rare-variant association testing for sequencing data
with the sequence kernel association test. The American Journal of Human Genetics, 89(1),
82–93.
Zhou, X. and Stephens, M. (2012). Genome-wide efficient mixed-model analysis for association
studies. Nature genetics, 44(7), 821–824.
Zhou, X., Carbonetto, P., and Stephens, M. (2013). Polygenic modeling with bayesian sparse
linear mixed models. PLoS genetics, 9(2), e1003264.

42

