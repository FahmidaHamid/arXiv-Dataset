Variational Scheme to Compute Protein Reaction Pathways using Atomistic Force
Fields with Explicit Solvent
S. a Beccara,1, 2 L. Fant,3 and P. Faccioli∗3, 2
1

We introduce a variational approximation to the microscopic dynamics of rare conformational
transitions of macromolecules. Within this framework it is possible to simulate on a small computer
cluster reactions as complex as protein folding, using state of the art all-atom force fields in explicit
solvent. We test this method against molecular dynamics (MD) simulations of the folding of an αand a β-protein performed with the same all-atom force field on the Anton supercomputer. We find
that our approach yields results consistent with those of MD simulations, at a computational cost
orders of magnitude smaller.

The development of the special-purpose Anton supercomputer has recently opened the way to MD simulations
of bio-molecules consisting of several hundreds atoms,
covering time intervals in the millisecond range [1]. By
using this facility, Shaw and co-workers characterized the
reversible folding of several small proteins, showing that
the existing all-atom force fields are able to attain the correct protein native structures [1–3]. Unfortunately, many
biologically important conformational reactions occur at
time scales many orders of magnitude larger than the millisecond. Hence, it is important to continue the development of more efficient algorithms to sample the reactive
pathways space (see e.g. [4] and references therein).
In particular, in the Dominant Reaction Pathways
(DRP) approach [5–8], microscopic trajectories X(τ ),
connecting given initial and final molecular configurations Xi = X(0) and Xf = X(t) are determined by maximizing their probability density P[X] in the Langevin
dynamics. This algorithm was first validated against MD
using both simplified and realistic atomistic force fields
(see e.g. Ref. [8]). Next, it was applied to characterize
in atomistic detail conformational reactions far too slow
to be investigated by means of plain MD. Notable examples include the folding of a knotted protein [9] and the
latency transition of several serpins [10].
One crucial limitation of the DRP method is that it
can only be applied in implicit solvent simulations. In
this work we overcome this limitation by introducing a
new variational approximation suitable also for atomistic
simulations in explicit solvent.
Let (X, Y ) represent a point the system’s configuration space, where X = (x1 , ..., xN ) and Y = (y1 , ..., yN 0 )
denote the solute and solvent coordinates, respectively.

∗ faccioli@science.unitn.it

5

8

4

Frequency

arXiv:1405.6104v2 [cond-mat.soft] 18 Feb 2015

European Centre for Theoretical Nuclear Physics and Related Areas (ECT*-FBK),
Strada delle Tabarelle 287, Villazzano (Trento), 38123 Italy
2
Trento Institute for Fundamental Physics and Applications (INFN-TIFPA), Via Sommarive 14 Povo (Trento), 38123 Italy.
3
Dipartimento di Fisica, Università degli Studi di Trento, Via Sommarive 14 Povo (Trento), 38123 Italy.

6

3

2

1

hairpin 2
0

4

0

0.2

0.4

0.6

Path Similarity S

0.8

1

hairpin 1

2

0

hairpin 2

kBT
Wednesday, October 29, 14

FIG. 1: Folding trajectories for the WW-domain (crystal
structure shown in the bottom right corner) obtained in the
variational approximation projected on the plain defined by
RMSD to the native structure of the two hairpins. The colormap in the background represents the free-energy landscape
obtained from the frequency histogram of the Anton MD trajectories. In the top-right corder: The similarity distribution
between variational and MD folding pathways (dashed line)
compared with the intrinsic similarity of MD folding pathways
(solid line).

The Langevin equations for the solvent and solute are
mi ẍi = −mi γi ẋi − ∇i U + ηi (t)

mj ÿj = −mj γj ẏj − ∇j U + ηj (t),

(1)

where U (X, Y ) is the potential energy, ηi is a white noise
and mi and γi denote mass and viscosity, respectively.
We are interested in the probability density for the
solute to make a transition from Xi to Xf in a time
t, along a given path X(τ ). This is given by the path
integral (PI)
Z
U (X ,Y )
−S
[X,Y ]− k i T i
B
,
(2)
P[X] =
DY e OM
where SOM [X, Y ] is the Onsager-Machlup functional, to
be defined below. Maximizing P[X] with respect to

2
the path X yields the DRP optimum condition [5–7]:
δ
δX hSOM [X, Y ]iY = 0, where the average h·iY refers to
the PI over Y (τ ).
Unfortunately, computing this average with the accuracy required for the path optimization is computationally unfeasible, because of large statistical fluctuations.
To overcome this problem, we need to derive an optimum criterion which does not involve any average over
the solvent dynamics.
We begin by considering a modified stochastic dynamics, defined by introducing into Eq. (1) an external (pos(X, t), acting on
sibly time-dependent) biasing force Fbias
i
the solute atoms only and accelerating the transition to
the product. The probability of a given reactive pathway
X(τ ) in the biased dynamics is given by
Z
U (X ,Y )
−S
[X,Y ]− k i T i
B
,
(3)
Pbias [X] = DY e bias
where the functional Sbias [X, Y ] is defined as
"N
Z t
X 1
1
Sbias ≡
dτ
(mi ẍi + mi γi ẋi
4kB T 0
γm
i=1 i i
0


bias 2

+∇i U − Fi

+

N
X
j=1

(4)


1
2
(mj ÿi + mj γj ẏj + ∇j U ) 
γj mj

The Onsager-Machlup functional SOM [X, Y ] entering
Eq. (2) is recovered setting Fbias
= 0 in Eq. (4).
i
Let us now return to the problem of computing the
reaction pathways in the unbiased Langevin dynamics
(1). Using the standard re-weighting trick we can write
δ
P[X] = 0 as
the variational condition δX
h
i
δ
Pbias [X] he−(SOM [X,Y ]−Sbias [X,Y ;t]) ibias = 0. (5)
δX
We now introduce our main approximation, by restricting the search for the optimum path X(τ ) within an ensemble of trajectories generated by integrating the biased
Langevin equation. By definition, these paths have a
large statistical weight in the biased dynamics, i.e. they
lie in the functional vicinity of some path X̄(τ ) which
satisfies δδX̄ P[X̄] = 0. Thus, the typical biased paths
approximatively satisfy the stationary condition
δ
P[X] ' 0
(6)
δX
and obey the corresponding saddle-point equations of
motion:
(
mi ẍi + mi γi ẋi + ∇i U − Fbias
'0
i
(7)
mj ÿj + mi γj ẏj + ∇j U ' 0.
We emphasize that Eq. (6) and (7) are only satisfied
by paths generated by integrating the biased Langevin
equation. Using Eq. (6) in Eq. (5) we find
0'

δ −(SOM [X,Y ]−Sbias [X,Y ])
he
ibias .
δX

(8)

The crucial point to observe is that, since the biasing
force Fbias
acts on the solute atoms only, the differi
ence ∆S[X] ≡ SOM [X, Y ] − Sbias [X, Y ] does not depend
on the solvent paths Y (t). Thus, Eq. (8) reduces to
δ
δX ∆S[X] = 0. Finally, we use the saddle-point approximation (7) again, in order to eliminate the cross-product
in
between the terms (mi ẍi + mi γi ẋi + ∇i U ) and Fbias
i
2
the expression for ∆S, yielding one more term ∝ |Fbias
|
.
i
This leads to our final variational condition:
δ
δX

Z

t

dτ
0

N
X
i=1

1
|Fbias
(X; τ )|2 ' 0.
i
γi m i

(9)

This equation states that the optimum reaction trajectory is that for which the time-averaged square modulus
of the bias force is least. Interestingly, a similar condition was recently derived in the context of optimal control
theory [18]. We emphasize that the functional in Eq.(9)
is not affected by solvent induced fluctuations.
Let us now extend this discussion to include the case
of a history-dependent biasing force. In particular, we focus on the ratchet-and-pawl molecular dynamics (rMD)
algorithm developed in Refs. [11, 12]. The advantage
of this formalism is that the bias only sets in whenever
the system attempts to backtrack towards the reactant
– defined in terms of some position-dependent reaction
coordinate (RC) z –. Conversely, no bias is applied whenever the system spontaneously takes a step towards the
product.
To define the rMD we consider the Langevin equations
D
(1) with an additional biasing force FrM
defined as
i
(
− k2R ∇i z(X) · (z(X) − zm (t)) z(X) > zm (t)
(10)
0,
z(X) ≤ zm (t).
zm (t) denotes the smallest value assumed by the RC z up
to time t (we assume that z is minimum in the target),
hence obeys the equation of motion żm = ż · θ(zm − z).
Let us now derive the PI expression for the path probability density PrM D [X]. To this end, we add a small
stochastic noise to turn the equation of motion of zm
into an overdamped Langevin equation. The PI representation for the path probability density in the extended
Langevin system (X, Y, zm ) is readily obtained. Finally,
PrM D [X] is recovered by taking the small-noise limit and
is given by:
Z
Z
U (X ,Y )
−S
[X,Y,zm ]− k i T i
B
PrM D [X] =
Dzm DY e rM D
z(Xi )

·

δ [żm − ż[X] θ(zm [X] − z)] ,

(11)

where SrM D [X, Y, zm ] is obtained from Eq. (4) by setting
Fibias (X, t) = FirM D (X, zm ). From here on, the derivation of the variational principle (9) is basically identical
to the case of an external biasing force reported above
(see Supplementary Material, SM).

3
helix 3

7

6

6

helix 2

helix 1

Frequency

5

4

3

2

1

0

0

0.2

0.4

0.6

Path Similarity S

0.8

3

0

kBT

FIG. 2:
Folding trajectories for villin (crystal structure
shown in left inset) obtained in the variational approximation, projected on the plain defined by the total RMSD to
the native structure and by the RMSD to the native structure of the residues in helix I and helix III (left panel) and
on
the plane defined by the RMSD to the native structure of
Wednesday, October 29, 14
helix I vs that of helix III (right panel). In the background
the free-energy landscape obtained from the Anton MD simulations is shown. In the right inset: Distribution of similarity
between variational and MD folding pathways (dashed line)
compared with the intrinsic similarity of MD folding pathways
(solid line).

Before presenting the results of atomistic protein folding simulations, it is instructive to illustrate and validate
the present variational approximation on a simple toy
model, that can be straightforwardly solved on a regular
desktop computer. To this end, in the SM we present our
study of a transition performed by a point particle diffusing on an asymmetric two-dimensional funnelled energy
landscape. The diffusion from the top to the bottom of
the funnel is thermally activated, due to the presence
of an energy barrier. Plain MD simulations show that
the particle reaches the bottom of the funnel by passing
through a gate, i.e. a spatially localised depression on
the energy barrier (see Fig. 4 in the SM).
We compared the results obtained using different algorithms to generate the trial paths (rMD and standard
steered MD) and different values of the biasing force constant kR . In all cases, we chose to bias the dynamics
along a rather poor reaction coordinate, which does not
take into account the presence of the gate.
We found that all the trajectories generated by steered
MD very closely follow the direction selected by the biasing coordinate, hence fail to predict the passage through
the gate. Hence, in general, we expect a variational calculation based on steered MD trial paths to yield rather
poor results, unless the reaction coordinate is very accurately known.
Results obtained by using rMD trial paths are definitely better (see Fig. 5 of the SM). In particular, even
when choosing a large value for kR , a significant fraction of the trial paths access the bottom of the funnel
through the gate. This is because in rMD the biasing

1

force is not continuously pushing the system, but only
sets in to hinder backtracking. We also note that the
variational principle systematically discards unphysical
trial rMD trajectories, and correctly predicts the essential qualitative features of the reaction. We conclude the
variational calculations based on rMD may yield reasonable results, even when the reaction coordinate is rather
poorly known.
Let us now report our application to the folding transition of two globular proteins: the WW-domain Fip35,
(with β-type native secondary structures, see Fig. 1),
and the villin headpiece subdomain (with α−type native secondary structures, see Fig. 2). In both cases, we
have used the AMBER99SB-ILDN all-atom force field
in TIP3P explicit water[13]. Several reversible foldingunfolding MD trajectories for these proteins generated
on Anton by using the same force field have been made
available by DES Research.
The rMD bias in Eq. (10) was based on the RC introduced in Ref. [12] (also reported in the SM), defined
as the distance between the instantaneous contact-map
and the native state’s contact map. The kR constant was
set to 5 × 10−3 kJ/mol. With this value, the modulus of
the total bias force was on average about two orders of
magnitude smaller than that of the total physical force.
We tested the robustness of our predictions by repeating
the variational calculation with different values of KR for
a given initial condition (see Fig.7 in the SM).
For each test protein, we have used the rMD algorithm to produce in total about one thousand 600 pslong trial folding trajectories, started from 10 different
(1)
(10)
denatured configurations Xi , . . . , Xi . The 10 initial
conditions were obtained by 1 ns of plain MD at the
temperature T = 800 K, starting from the crystal native
state and thermalized by 200 ps at 300 K. Folding events
were defined as those attaining a final root-mean-squaredeviation (RMSD) to the native structure smaller than
2 Å. For each initial condition a single folding trajectory
was selected out the ensemble of trial paths by applying
condition (9).
In order to define a convergence criterion for the variational search we note that the least value of the functional
(9) is non-negative and vanishes for spontaneous transitions. These events have a negligible probability to be
observed in the short simulation time, t ∼ 200 ps. Typically, we observed that the least value of the functional
(9) decreases on increasing the number of trial trajectories, until it reaches a plateau for more than ∼ 50 trial
paths (see Fig. 3).
It is important to check that, once the plateau region is reached, the predicted folding mechanism does
not change when increasing the number of trial trajectories. To this end, we adopted a simplified representation
of the folding mechanism realized in a given trajectory:
We define a matrix M̂ , which describes the order in which
the native contacts are formed [12]. Namely, let i, j be

6

two indexes running over all native contacts between Cα
atoms, and let ti (k) and tj (k) be the times at which they
are formed. The matrix element Mij (k) is defined to be
1(0) when ti (k) < tj (k) (ti (k) > tj (k)) and 1/2 when
ti (k) = tj (k). A quantitative measure of the difference
in the folding mechanism followed by two given trajecto0
ries k and k 0 is provided by their
P path similarity s(k, k0 ),
1
0
defined as s(k, k ) = Nc (Nc −1) i6=j δ(Mij (k) − Mij (k )).
Notice that s(k, k 0 ) = 1 if all native contacts are formed
in the same order in k and in k 0 , and is 0 if they are
formed in a completely different order.
The path similarity can be used to assess the stability
of the predicted folding mechanism in the plateau region.
For each given initial condition X (i) we computed the
similarity between pairs of variational folding pathways,
obtained using a different number of trial trajectories.
Namely, we computed the similarity of the variational
path obtained with 16 and 48, with 48 and 64, and with
64 and 96 trial trajectories. We found that the mechanism remains stable (s(k, k 0 ) >
∼ 0.9) above 48 trial paths,
i.e. in the plateau region.
In Fig.1 we project the folding trajectories for the
WW-domain obtained with our variational approach
onto the plane defined by the root-mean-square deviation (RMSD) of the two hairpins to the native state and
we compare it with the free-energy landscape obtained
from a frequency histogram of the long MD trajectories
reported in Ref.[1].
Some comments on these results are in order. First,
we note that the initial conditions used in the variational
calculation are typically more denatured than the configurations in the equilibrium unfolded state obtained in
the Anton simulation. In spite of this difference, the
variational trajectories reach the native state by traveling along regions of low free-energy. This fact indicates
that the two methods yield the same folding mechanism,
i.e. predict that the formation of the secondary structures predominantly occurs in a definite sequence and
that in the most likely mechanism the N terminal hairpin folds before the C terminal [1, 17], in agreement with
the φ-values analysis of Ref. [16].
To provide a quantitative measure of the agreement
between the variational and the MD paths, we employed
again a path similarity analysis. First, we computed the
distribution of s(k, k 0 ) within the ensemble of MD folding trajectories (see dashed line in the inset of Fig. 1),
to quantify the intrinsic degree of heterogeneity of the
folding mechanism. Next, we computed the similarity
between all MD and all variational paths, i.e. s(k, k 0 ),
where k and k 0 run over MD and variational trajectories,
respectively (solid line). The overlap of the two curves
indicates that the average difference between the folding mechanism obtained in the two methods lies within
intrinsic statistical fluctuations.
A concern about the variational approach is that the
bias may over-promote the rate of formation of local sec-

Average penaltys functional (x 10 )

4

WW-domain
Villin

0.5
0.4
0.3
0.2
0.1
0
0

20

40
60
80
Number of trial trajectories

100

FIG. 3: The average value of the penalty functional given in
Eq. (9) as a function of the number of trial trajectories. The
average is performed over the different initial conditions.

ondary structures, in particular α−helixes, relative to
that of tertiary structures. In order to test if this is
the case, we have studied the folding of villin head-piece
subdomain, which contains three α-helixes. In the left
panel of Fig.2 we report our variational folding trajectories projected onto the plane defined by the RMSD to
native of the two largest α−helixes and the total RMSD
to the native structure. We see that the two approaches
give consistent results and predict that the formation
of secondary and tertiary contacts is quite co-operative.
Hence, we conclude that the bias force does not enhance
the folding rate of α-helixes.
In the right panel of Fig. 2, we project the variational
trajectories onto the plane defined by the RMSD to native of the first and third helix, respectively and we compare it with the corresponding equilibrium free-energy
landscape. We note again that the variational trajectories travel along low free-energy regions, correctly predicting that the secondary structures form one after the
other. However, we found that the preferential order of
helix formation is different in the two calculations. This
fact is reflected by a small discrepancy in the path similarity between MD and variational trajectories, of the
order of the typical spread of the self-similarity distribution of the MD paths (see the inset in the top-right
corner of Fig. 2). As a reference, the similarity distribution with random sequences of contacts formation for the
folding mechanism predicted by our variational method
or by MD is sharply peaked around 0.3 (see Fig.8 in the
SM).
In conclusion, the variational approach introduced in
this work yields the microscopic mechanism for reactions
as complex as protein folding, using realistic force fields
in all-atom detail. In view of its computational efficiency,
we foresee applications to many transitions that cannot
be simulated by plain MD. The possibility of adopting the
explicit solvent all-atom model opens the door to the simulation of conformational changes of other biomolecules,
notably nucleic acids.

5
We thank DES Research for making available their MD
simulation data and acknowledge discussions with H. Orland and S. Piana. All calculations were performed on
the Kore cluster at the FBK institute. S. a B. acknowledges support by Istituto Nazionale di Fisica Nucleare
through the ”Supercalcolo” agreement with Fondazione
Bruno Kessler.

[1] Shaw et al., Science 330, 341 (2010).
[2] K. Lindorff-Larsen, S. Piana, R. Dror, and D.Shaw, Science 334, 517 (2011).
[3] S. Piana,K. Lindorff-Larsen and D. Shaw, Proc. Natl.
Acad. Sci. USA 109, 17845 (2013).
[4] W. E and E. Vanden-Eijnden, Ann. Rev. Phys. Chem.61,
391 (2010)
[5] R. Elber and D. Shalloway, J. Chem. Phys. 112, 5539
(2000).
[6] P. Faccioli, M. Sega, F. Pederiva, and H. Orland, Phys
Rev Lett 97, 108101 (2006). M. Sega, P. Faccioli, F. Pederiva, G. Garberoglio, and H. Orland, Phys. Rev. Lett.
99, 118102 (2007).
[7] P. Eastman, N. Gronbech-Jensen, and S. Doniach, J.
Chem. Phys. 114, 2823 (2001).
[8] S. a Beccara, T. Škrbić, R. Covino, and P. Faccioli, Proc.
Natl. Acad. Sci. USA 109, 2330 (2012).
[9] S. a Beccara, T. Škrbić, R. Covino, C. Micheletti, and
P. Faccioli, PLoS Comp. Biol. 9, e1003002 (2013).
[10] G. Cazzolli et. al., Proc. Natl. Acad. Sci. USA 111, 15414
(2014)
[11] E. Paci and M. Karplus, J. Mol. Biol. 288, 441 (1999).
[12] C. Camilloni, R. Broglia, and G. Tiana, J. Chem. Phys.
134, 045105 (2011).
[13] K. Lindorff-Larsen et. al., Proteins 78, 1950 (2010).
[14] R. B. Best and G. Hummer, Proc. Natl. Acad. Sci. USA
102, 6732 (2005).
[15] S. Deechongkit et. al., Nature 430 101 (2004). M. Jäger,
H. Nguyen, J.C.Crane, J.W. Kelly and M. Gruebele, J.
Mol. Biol. 311, 373 (2001).
[16] T. R. Weikl, Biophys. J. 94, 929 (2008).
[17] S. V. Krivov, J. Phys. Chem. B 115, 6 (2011).
[18] C. Schütte, S. Winkelmann and C. Hartmann, Math.
Program., Ser. B 134, 259 (2012).

SUPPLEMENTARY MATERIAL

INTERMEDIATE STEPS IN THE DERIVATION
OF THE VARIATIONAL PRINCIPLE BASED ON
THE RATCHET-AND-PAWL MOLECULAR
DYNAMICS (RMD)

Eq. (10) is the basis of the variational approach and
was explicitly derived in the case of an external (i.e. pathindependent) biasing force. In this section we provide
some details of the derivation of the same condition in
the case of the rMD, where the biasing force depends on
the previous history of the system.
In the main text, we have shown that in rMD the probability for the system to go from Xi to Xf along the path
X(τ ) in time t is given by the path integral (PI)
Z
Z
U (X ,Y )
−S
[X,Y,zm ]− 2k i T i
B
PrM D [X] =
Dzm DY e rM D
z(Xi )

·

δ [żm − ż[X] θ(zm − z[X])] ,

(12)

The probability to perform the same transition in the
unbiased Langevin dynamics is given in Eq. (4) of the
main text. The same probability can also be written in
a form involving an additional path integral in zm (τ ), at
the expense of introducing a functional-delta:
Z
Z
U (X ,Y )
−S
[X,Y ]− 2k i T i
B
P[X] =
Dzm DY e OM
z(Xi )

·

δ [żm − ż[X] θ(zm − z[X])] .

(13)

The expressions (12) and (13) are almost identical, except for the fact that the latter contains the
exponent of the standard Onsager-Machlup functional
SOM [X, Y ], rather than the corresponding biased functional SrM D [X, Y ]. This reflects the fact that in the standard Langevin dynamics, the history of zm affects neither
the solute nor the solvent dynamics.
Now, in analogy with Eq. (6) of the main text, we use
the standard reweighing trick to obtain:
P[X] = PrM D [X]he−(SOM [X,Y ]−SrM D [X,Y,zm )) izm ,Y (14)
where now h·izm ,Y denotes the rMD average over the Y
and zm histories. Now we note that the term at the
exponent does not depend on the solute dynamics,
SOM [X, Y ] − SrM D [X, Y, zm ] ≡ ∆S[X, zm ].

(15)

Thus, the average over Y can be dropped, and one finds:
P[X] = PrM D [X]he−∆S[X,zm ] izm

(16)

We now compute the functional derivative of P[X]
with respect to the trial path X. Following the same

6
saddle-point argument used in the main text in the discussion of the case with an external bias force, we neglect
the term proportional to δPrM D /δX and use the saddlepoint equations of motion:
D
mi ẍi + mi γi ẋi + ∇i U − FrM
(X, zm ) ' 0 (17)
i

żm − ż[X] θ(zm − z) = 0

(18)

to remove the time-derivative terms from the expression
of ∆S. We stress that the second of these equations
is exact, while the first is only approximate. Finally,
denoting with ẑm (t) the (unique) solution of Eq(18) we
arrive to the variational principle:
Z t X
N
1
δ
D
dτ
|FrM
(X; ẑm [X])|2 ' 0. (19)
i
δX 0
γ
m
i
i
i=1
COLLECTIVE COORDINATE FOR RMD
SIMULATIONS OF PROTEIN FOLDING

Following Ref. [12] of the main text, in our rMD simulations we have biased the dynamics according to a reaction coordinate (RC) defining a distance between the
instantaneous contact map and the native contact map:
z(X) ≡

N
X

[Cij (X) − Cij (X native )]2 .

(20)

|i−j|>35

In this equation, Cij (X) and Cij (X native ) are the instantaneous and native contact maps, respectively. Their entries are chosen so as to interpolate smoothly between 0
and 1, depending on the relative distance of the atoms i
and j:
Cij (X) = {1 − (rij /r0 )6 }/{1 − (rij /r0 )10 },

(21)

where r0 =7.5 Å is a fixed reference distance. The contribution to the bias force due to a pair of atoms specified
by the indexes i and j was set to 0 smoothly any time the
distance between these atoms was larger than the cut-off
distance rc = 12Å.
ILLUSTRATIVE APPLICATION IN A TOY
MODEL

In order to illustrate our variational method and highlight its strengths and limitations, it is instructive to apply it to a toy model that can be straightforwardly simulated on a desktop computer.
We consider the diffusion on the two-dimensional energy surface defined by the potential
A1 s21
+ y 2 + s21 )2
A2 s22
A3 s23
+ 2
−
(22)
2
(x + y 2 + s2 )2
((x − xm )2 + (y − ym )2 + s23 )2
U (x, y) = w2 (x2 + y 2 )2 −

(x2

with A1 = 30, A2 = 20, A3 = 6, s1 = 1, s2 = 2, s3 = 2,
w = 0.03, ym = 0 and xm = 1.5. The corresponding
energy landscape is shown in the left panel of Fig.4.
We generated 20, 000 independent trajectories integrating the standard underdamped Langevin equation
starting from the same initial condition (xi = 0, yi = 5)
located in the outer flat region. We used γ = 1, dt = 0.02
and kB T = 0.2, and selected only the paths which
reached the product state (x = 0, y = 0), at the bottom of the funnel.
At this temperature, crossing the ring barrier surrounding the funnel is a thermally activated process. As
a result, after 90,000 integration steps only a few trajectories reached the product state, by accessing the funnel
through the gate located at (x ∼ 1.5, y ∼ 0) (see right
panel of Fig.4).
Let us now compare these results with those obtained
using our variational approach. As a first step, we integrated 2000 trial trajectories of rMD dynamics consisting
of 30,000 time-steps, using as biasing coordinate
the Eup
clidean distance from the product, z = x2 + y 2 . We
emphasise that this choice of reaction coordinate is certainly not optimal, since it does not take into account
the existence of the gate.
Next, we selected the optimum trajectory among all
the trial trajectories, by applying the variational condition given in Eq. (8). We repeated this procedure for
a wide range of biasing strength constants KR , covering
over more than two orders of magnitude. We emphasize
that also in this model rMD allows to generate a large
ensemble of trial reactive trajectories at a fraction of the
computational cost required by plain Langevin dynamics.
The results are shown in Fig. 5. First we note that,
at low values of the biasing force (KR < 4), the fraction
of trial trajectories reaching the product state within the
simulation time varies significantly with KR . For larger
values of KR , saturation is reached and almost all trial
trajectories attain the final state.
As KR is raised, we observe an increasing fraction of
trial reactive trajectories crossing the ring barrier, in contrast with what is seen in plain Langevin dynamics. This
is an artifact due to our bad choice of the biasing reaction coordinate. However, once the variational condition
is applied, such unrealistic paths are discarded. Indeed,
the results obtained at all values of KR correctly predict the essential feature of the reaction, i.e. the crossing
the gate. On the other hand, the optimum paths corresponding to the largest values of biasing strength are
significantly shorter and tend to travel along a line closer
to the vertical ŷ axis.
Finally, it is interesting to compare the results obtained
using rMD to generate the trial paths to those obtained
using a standard steered MD, where a constant harmonic
force with strength constant KR is introduced to guide
the path towards the bottom of the funnel. The results
shown in Fig. 6 clearly show that the performance of the

7
variational method is significantly worse for calculations
based on steered MD than on rMD. The better performance of rMD as compared to steered MD is probably
due to the fact that former scheme does not push the
system towards the product state, but it only hinders
backtracking. This feature also reduces the effect of a
suboptimal choice of the reaction coordinate.

6

4

4

4

2

2

2

0

0

Y

-2

-2

-4

-4

-4

-6

-6

-4

-2

0
X

2

4

6

-6

-6

-4

rMD trajectories, kR= 4

MD trajectories
6

4

Y

2

0

-2
6
4
-6

-4

-4

0
-2

0
X

-2
2

Y

-4
4

6

-6

-6
-6

-4

-2

0
X

2

4

FIG. 4: Left panel: two dimensional energy surface of the
illustrative toy model. The dark line represents a typical reactive trajectory. Right panel: set of reactive trajectories
obtained by plain Langevin dynamics.

2

4

-6

6

6

4

4

2

2

2

0

0

Y

6

-2

-2

-4

-4

-4

-6

-6
0
X

2

4

6

0
X

2

4

6

6

0

-2

-2

-2

rMD trajectories, kR= 16

4

-4

-4

-6
-6

-4

-2

0
X

2

4

6

-6

-4

-2

0

2

4

X

FIG. 5: Reactive pathways obtained by the variational approach using different values of the biasing constant KR . The
light line is the optimum, selected according to the variational
condition (8).

In Fig.8 we show the distribution of similarity between
the orders of contact formation found in the folding pathways calculated for villin using the variational approach
or plain MD and a random order of contact formation.
As a reference, the solid line denotes the distribution of
similarity between pairs of random sequences of native
contact formations. We see that these distributions are
indistinguishable and are sharply peaked around 0.3.

2

0
X

6

-6

PATH SIMILARITY AGAINST RANDOM
NATIVE CONTACT FORMATION

2D Potential Surface

-2

rMD trajectories, kR= 8

Y

Y

To assess the sensitivity of the atomistic variational
results on the choice of the biasing constant kR , in
Fig.7 we compare the results obtained for the folding
of Fip35 from a given initial condition, using KR =
2.5, 5, 7.5 × 10−3 kJ/mol. We find that the resulting folding mechanism is the same.

0

-2

-6

DEPENDENCE ON THE FOLDING PATHWAYS
ON THE STRENGTH OF THE BIASING FORCE

rMD trajectories, kR= 2

rMD trajectories, kR= 1
6

Y

Y

rMD trajectories, kR= 0.1
6

6

8
Steering MD trajectories, kR= 2
6

4

2

Y

0

-2

-4

-6
-6

-4

-2

0
X

2

4

6

FIG. 6: Variational calculation of the reaction pathways obtained using a steered MD algorithm (instead of the rMD
algorithm) to generate the trial paths.

8

kR = 2.5 ⇥ 10

3

kJ/mol

RMSD for hairpin 2 / Å

6

4

kR = 7.5 ⇥ 10

kR = 5 ⇥ 10

3

3

kJ/mol

kJ/mol

2

0
0

2

4
RMSD for hairpin 1 / Å

6

8

FIG. 7: Comparison between the reaction pathways for Fip35
obtained starting from the same initial conditions using three
different values for the strength of the biasing constant KR =
2.5, 5.0, 7.5 × 10−3 kJ/mol.

9
25

Frequency

20

15

Random vs Random
Variational vs Random
MD vs Random

10

5

0

0

0.2

0.4

0.6

Path Similarity S

0.8

1

FIG. 8: Distribution of similarity between the order of native contact formation in villin obtained in different theoretical approaches and in an ensemble of random sequences of
native contact formation. The solid line denotes the distribution of similarity between two random sequences of native
contact formation, the dashed (dot-dashed) line the similarity between variational (plain MD) trajectories and random
sequences of native contact formation.

