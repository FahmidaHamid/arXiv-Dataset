Coalescent histories for lodgepole species trees

arXiv:1503.03560v1 [q-bio.PE] 12 Mar 2015

Filippo Disanto∗
Noah A. Rosenberg
Department of Biology, Stanford University, Stanford, CA 94305 USA

March 13, 2015

Abstract
Coalescent histories are combinatorial structures that describe for a given gene tree and species tree the
possible lists of branches of the species tree on which the gene tree coalescences take place. Properties of the
number of coalescent histories for gene trees and species trees affect a variety of probabilistic calculations in
mathematical phylogenetics. Exact and asymptotic evaluations of the number of coalescent histories, however,
are known only in a limited number of cases. Here we introduce a particular family of species trees, the
lodgepole species trees (λn )n≥0 , in which tree λn has m = 2n + 1 taxa. We determine the number of coalescent
histories for the lodgepole species trees, in the case that the gene tree matches the species tree, showing that this
number grows with m!! in the number of taxa m. This computation demonstrates the existence of tree families
in which the growth in the number of coalescent histories is faster than exponential. Further, it provides a
substantial improvement on the lower bound for the ratio of the largest number of matching coalescent histories
to the
histories
√
√ coalescent
√ for trees with m taxa, increasing a previous bound
√ smallest number of matching
of ( π/32)[(5m − 12)/(4m − 6)]m m to [ m − 1/(4 e)]m . We discuss the implications of our enumerative
results for phylogenetic computations.
Key words: coalescence, genealogy, phylogeny.

1

Introduction

Advances in the mathematical investigation of gene genealogies and the increasing availability of genetic data from
diverse taxa have clarified that species trees, representing the branching histories of populations of organisms,
need not be reflected in gene trees that represent the histories of individual genomic regions (Pamilo and Nei,
1988; Maddison, 1997; Nichols, 2001). New developments concerning the relationship between gene trees and
species trees have now led to new methods for species tree inference, new approaches to inferences about evolutionary phenomena from gene tree discordance, and an improved understanding of the branching descent process
(Degnan and Rosenberg, 2009; Liu et al., 2009; Knowles and Kubatko, 2010).
Investigations of the evolution of genomic regions along the branches of species trees have also generated new combinatorial structures that can assist in studying gene trees and species trees (Maddison, 1997;
Degnan and Salter, 2005; Than and Nakhleh, 2009; Wu, 2012). Among these structures are coalescent histories,
structures that for a given gene tree topology and species tree topology represent possible pairings of coalescences
in the gene tree with branches of the species tree on which the coalescences take place (Degnan and Salter, 2005;
Rosenberg, 2007).
Coalescent histories are important in a number of types of studies of the relationship between gene trees and
species trees. They have appeared in empirical investigations of the gene tree topologies likely to be produced
∗

Corresponding author. Email: fdisanto@stanford.edu.

1

Natural logarithm
of the number of coalescent histories

7
6
5
4
3
2
1
0
3

4

5

6

7

8

9

Number of leaves

Figure 1: Natural logarithm of the number of coalescent histories for all matching gene trees and species trees with at
most 9 taxa. The values plotted are taken from Tables 1-4 of Rosenberg (2007). Each dot corresponds to a tree of the
specified size. The line represents a linear regression y = a + bx, with a ≈ −2.91891 and b ≈ 1.07865.
along the branches of a given species tree (Rosenberg and Tao, 2008). They are a component of mathematical
proofs that concern properties of evolutionary models of gene trees conditional on species trees (Allman et al.,
2011; Than and Rosenberg, 2011). Coalescent histories also arise in studying state spaces for models that consider
transitions along the genome among the gene genealogies represented at specific sites (Hobolth et al., 2007, 2011;
Dutheil et al., 2009).
Many coalescent histories might be possible for a given gene tree and species tree, and the number of possible
coalescent histories is a key quantity in the study of gene trees and species trees. In particular, because the
probability of a gene tree topology conditional on a species tree can be written as a sum over coalescent histories
(Degnan and Salter, 2005), the time required for computing gene tree probabilities is proportional to the number
of coalescent histories compatible with a given gene tree and species tree. Thus, to study computational aspects
of the use of coalescent histories, it has been of interest to evaluate the number of coalescent histories permissible
for a given pair consisting of a gene tree and a species tree.
Degnan and Salter (2005), who initiated the study of coalescent histories, reported that if the labeled gene
tree topology and species tree topology have the same matching “caterpillar” shape with m taxa, then the number
of coalescent histories is the Catalan number,


1 2m − 2
.
(1)
cm−1 =
m m−1

√
The Catalan sequence cm is asymptotic to 4m /(m3/2 π). Rosenberg (2007) and Than et al. (2007) provided
recursive procedures that list all possible coalescent histories given a gene tree and species tree, and Rosenberg
(2007) offered simple recursive formulas for counting them. Rosenberg (2007, 2013) and Rosenberg and Degnan
(2010) then solved the recursion in a number of specific cases.
What is the asymptotic behavior of the number of coalescent histories as the number of taxa increases? In
Figure 1, we show values taken from Rosenberg (2007) for the number of coalescent histories for matching gene
trees, for all species trees with m ≤ 9 taxa. On a logarithmic scale, a linear model fits the values quite well,
suggesting that in general, the number of coalescent histories for matching gene trees and species trees might
grow exponentially in the number of taxa. Existing enumerations of coalescent histories in particular cases, both
for the caterpillar trees in eq. 1 and in related caterpillar-like families (Rosenberg, 2013), support this prediction.
We might therefore expect that for a generic family of species trees of increasing size, the number of coalescent
histories for the matching gene tree increases exponentially.
2

A

C

B

h( k2 )
h( k)
h ( k1 )

k1
k
A B C D

E

A B C D

E

A B C D

k2
E

A B C D

E

A B C D

E

A B C D

E

Figure 2: Coalescent histories with matching gene trees and species trees. (A) A matching coalescent history. (B)
Condition (a) for matching coalescent histories is violated because leaf B descends from node k but not from branch h(k).
(C) Condition (b) for matching coalescent histories is violated, as node k2 descends from node k1 but the branch h(k2 )
remains strictly above the branch h(k1 ).

Here, we show that this prediction does not always hold. Indeed, we exhibit a family of species trees (λn )n —
that we term the lodgepole family—whose number of coalescent histories grows with the double factorials, and
thus increases at a rate that is faster than exponential in the number of taxa. We use the lodgepole family to
further understand the variability at a given m of the number of coalescent histories for cases with matching
gene trees and species trees. Rosenberg (2007) obtained a lower bound on the ratio of the largest number of
coalescent histories to the smallest number of coalescent histories at m taxa, showing that this ratio was greater
√
√
than a constant multiple of ( π/32)[(5m − 12)/(4m − √
6)]m m. Here we improve substantially upon this lower
√ m
m − 1/(4 e) .
bound, demonstrating that it exceeds the much larger

2
2.1

Preliminaries
Species trees and coalescent histories

A species tree is a binary rooted tree equipped with a labeling for the leaves. As in other studies of coalescent
histories, a single labeling can without loss of generality be taken as representative of an unlabeled species tree
topology. When the labeling is not needed, we abbreviate the arbitrarily labeled species tree by its unlabeled
shape and consider the labeled and unlabeled topologies interchangeably. We consider matching gene trees and
species trees with the same labeled topology t.
We term a coalescent history for the case when the gene tree and species tree have the same labeled topology
a matching coalescent history. Given a species tree t, a mapping h from the internal nodes of t to the branches of
t is a matching coalescent history of t when it satisfies both of the following two conditions: (a) for all leaves x
in t, if x descends from internal node k in t, then x descends from branch h(k) in t; (b) for all internal nodes k1
and k2 in t, if k2 is a descendant of k1 in t, then branch h(k2 ) is descended from or coincides with branch h(k1 )
in t. Figure 2A shows an example of a matching coalescent history. The examples in Figure 2B and 2C are not
matching coalescent histories; in Figure 2B, condition (a) is violated, and in Figure 2C, condition (b) is violated.

2.2

The lodgepole family of species trees

We focus here on the number of matching coalescent histories (histories or coalescent histories for short) for a
particular family of species trees, (λn )n≥0 , that we call the lodgepole family. We define λ0 as the 1-taxon tree.
For n ≥ 0, we inductively define λn+1 by appending λn and a tree with two leaves (a cherry) to a common root
(Fig. 3). Note that the tree λn has m = 2n + 1 rather than n taxa; we use n to denote the nth tree λn of the
lodgepole family and perform our enumerations according to this parameter, later returning to m, the number
of taxa. We view λn as unlabeled, or as having an arbitrary labeling.
The lodgepole family (λn )n≥0 can be seen as a modification of the caterpillar family of species trees, in which a
family of trees is generated by sequentially appending the previous tree in the family and a single taxon—instead
of a cherry, as in the lodgepole family—to a common root.
3

λn =
n pairs

Figure 3: The lodgepole family of species trees λn . Starting from the tree with one taxon (λ0 ), by adding n ≥ 0 cherries,
we obtain the tree λn . The term lodgepole is after the lodgepole pine tree, Pinus contorta, one of a number of pine species
in which needles extend from the main twig in bundles of two.

2.3

Dyck paths

To enumerate histories for lodgepole species trees, we make use of results that involve certain lattice paths, the
Dyck paths (Stanley, 1999). A Dyck path of size n is a lattice path that starts from (0, 0) and ends at (2n, 0)
in the quarter plane, that has n unit steps up (each labeled U ) and n unit steps down (labeled D), and that
never passes below the x-axis (Fig. 4A). It is useful to distinguish the indecomposable Dyck paths from the
decomposable ones. A Dyck path of size n is said to be indecomposable when it touches the x-axis only at the
extreme points (0, 0) and (2n, 0). A Dyck path is decomposable if it is not indecomposable. In Figure 4B, the
two Dyck paths at the top are indecomposable, and the remaining three are decomposable.

3
3.1

The number of matching coalescent histories for lodgepole species trees
Overview

We are now ready to compute the number hn of matching coalescent histories for the lodgepole tree λn . We start
in Section 3.2 by obtaining a combinatorial formula that computes hn as a sum over a certain set of vectors Vn .
In Section 3.3, we show that by a bijection of coalescent histories for λn with a certain set of Dyck paths Dn —a
set that is in turn related to structures known as indecomposable histoires d’Hermite—we can apply existing
enumerative results to obtain a recursion for hn . Finally, in Section 3.4, we study the asymptotic behavior of hn .

3.2

A first combinatorial formula for hn

For n ≥ 1, we define a set Vn of integer vectors a = (a1 , a2 , ..., an ) as
Vn = {a : a1 = 2 and 2 ≤ ai ≤ ai−1 + 1 for 2 ≤ i ≤ n}.
Setting, for instance, n = 3, we obtain V3 = {(2, 2, 2), (2, 2, 3), (2, 3, 2), (2, 3, 3), (2, 3, 4)}.
We have the following combinatorial formula to compute, for n ≥ 1, the number of matching coalescent
histories hn for the lodgepole species tree λn :
hn =

n
XY

ai .

(2)

a∈Vn i=1

Eq. 2 can be justified by formulating the procedure of Rosenberg (2007) for tabulating coalescent histories
specifically in the lodgepole case, observing that a history of λn can be constructed in two steps. In the tree
λn , it is convenient to distinguish a main branch, that is, the one from which the n cherry nodes in λn descend
(Fig. 5A). The main branch of λn thus contains n internal nodes that we treat as ordered from the root (the
4

B

A

2
1
0
0 1 2 3 4 5 6

3
2
1
0
0 1 2 3 4 5 6

2
1
1
0
0 1 2 3 4 5 6

0
0

1

2

3

4

5

6

7

8

2
1
0
0 1 2 3 4 5 6

2
1
0
0 1 2 3 4 5 6

Figure 4: Dyck paths. (A) The Dyck path of size 4 whose sequence of steps is U U DU DDU D. It contains 4 unit up-steps
U and 4 unit down-steps D that never pass strictly below the x-axis. (B) The five possible Dyck paths of size 3. The two
at the top are indecomposable because they touch the x-axis only at the endpoints (0, 0) and (6, 0).

first node) toward the single leaf at the end of the branch. In step (a), we fix a history for the nodes of the
main branch, ignoring the attached cherries. In Figure 5A, this history is represented by the solid arcs: each
arc maps a node of the main branch onto a permissible branch. In step (b), we choose a mapping for the cherry
nodes (dashed arcs in the figure). The choice for the mapping of the cherry nodes must be compatible with the
mapping in step (a) for the nodes of the main branch of λn . As required by the definition of coalescent histories
in Section 2.1, the image of a cherry node k cannot be placed on a branch above the one chosen in step (a) as
the image of the node of the main branch to which node k is appended.
The two-step procedure translates into eq. 2. In fact, each possible history of the main branch of λn can
be bijectively encoded by a vector of integers (a1 , ..., an ) ∈ Vn by noting that the ith node of the main branch
is mapped exactly ai − 2 nodes above it, associating each node with its immediate ancestral branch (Fig. 5A).
Once the vector has been fixed, the cherry node appended to the ith node of the main branch can be mapped in
exactly ai compatible ways. Therefore, with the sum in eq. 2, we are considering all the possible histories of the
main branch—those constructed in step (a)—and for each of these histories, the product counts the number of
compatible mappings of the cherry nodes as considered in step (b).
By applying eq. 2, setting h0 = 1 for convenience, we computed the first terms of the sequence hn (Table 1).
The values for n = 1, 2, 3, 4 accord with the values computed in the enumerations of coalescent histories reported
for small trees in Tables 1 and 4 of Rosenberg (2007).

3.3

Correspondence with the histoires d’Hermite and a recursion for hn

We now show that a bijective correspondence exists between histories of the lodgepole family (λn )n≥0 and certain
labeled paths in the plane. Indeed, note that as in the example in Figure 5B, each vector a ∈ Vn bijectively
encodes a Dyck path of size n ≥ 1. More precisely, starting from the vector a, a Dyck path with n up-steps is
uniquely determined by fixing for each i the ordinate yi of the endpoint of the ith up-step according to
ai = yi + 1.

(3)

For instance, in Figure 5B, we depict the Dyck path U U DU DDU D associated with the vector a = (2, 3, 3, 2) ∈ V4 :
in fact, as in eq. 3, we have y1 = 1 = a1 − 1, y2 = 2 = a2 − 1, y3 = 2 = a3 − 1, and y4 = 1 = a4 − 1.
Defining Dn as the set of Dyck paths of size n that for each i have the ith up-step Ui labeled by an integer
ℓ(Ui ) ∈ [1, yi + 1],

(4)

we can also interpret eq. 2 as the formula that computes the cardinality |Dn |, so that
hn = |Dn |.
5

(5)

A

C

B

1

1

a1= 2

1

2 3

1

1

2 3

2

1

a4 = 2

1

2 3

2

1

2

1

2

3

a2 = 3
a3 = 3

2 3

2

2

1

1

0

0
0

1

2

3

4

5

6

7

8

0

1

2

3

4

5

6

7

8

9

10

Figure 5: Combinatorial structures for computation of hn : coalescent histories, labeled Dyck paths, and histoires d’Hermite.
(A) Coalescent histories of λ4 . Arcs represent the mapping of the nodes of λ4 to its branches. Each history of λn can
be constructed in two steps. First, a mapping of the nodes of the main branch to branches of the tree is fixed. Next, a
compatible mapping of the cherry nodes is constructed. For the nodes of the main branch, the mapping in the figure is
encoded by the vector a = (a1 , a2 , a3 , a4 ) = (2, 3, 3, 2) ∈ V4 : for i = 1, 2, 3, 4, the ith node of the main branch is mapped
onto the branch ai − 2 nodes above it (solid arcs). Dashed arcs represent possible mappings of the cherry nodes that are
compatible with the mapping for the main branch determined by the vector a. The ith cherry node can be mapped in
exactly ai compatible ways. (B) A labeled Dyck path of size 4, encoding the vector (a1 , a2 , a3 , a4 ) = (2, 3, 3, 2) ∈ V4 from
(A). The ordinate yi of the endpoint of the ith up-step Ui satisfies yi = ai − 1. By labeling each up-step Ui of the path with
an integer ℓ(Ui ) ∈ [1, yi + 1], we obtain a path in D4 . The number of ways that the underlying Dyck path can be labeled
Q
is thus given by the product n=4
i=1 ai = 36. (C) The indecomposable histoire d’Hermite of size 5 associated with the Dyck
path of size 4 in (B). The histoire is obtained by adding an up-step labeled 1 at the beginning of the path in (B) and a
down-step at the end and keeping the labels of the remaining up-steps as in (B). In this way, the ith up-step Ui of the
histoire in (C) has an integer label ℓ∗ (Ui ) ∈ [1, yi ], where, as in (B), yi is the ordinate of the endpoint of the ith up-step.
Eq. 5 holds for n ≥ 0 including the case n = 0, as we set h0 = 1, and by counting the empty path, D0 = 1. In
interpreting eq. 2 as an enumeration of labeled Dyck paths in Dn , the sum in eq. 2 traverses
Q all possible Dyck
paths of size n as encoded by vectors in Vn . For each of these Dyck paths, the product ni=1 ai computes the
number of ways that the path can be labeled. By eqs. 3 and 4, each label ℓ(Ui ) has ai possible values.
This result, similar to a bijection with monotonic paths used by Degnan (2005) to count coalescent histories
in the caterpillar case, allows us to switch from counting the histories of λn to counting labeled paths in Dn .
The correspondence in eq. 5 can be used to obtain a recursion for hn . Starting with h0 = 1, we have for n ≥ 1,
hn = (2n + 1)!! −

n−1
X

(2k + 1)!! hn−1−k .

(6)

k=0

To prove eq. 6, we make use of the relationship between the labeled Dyck paths in Dn and the so-called histoires
d’Hermite of size n + 1 (histoires for short, Fig. 5C).
An histoire of size n ≥ 1 is a labeled Dyck path of size n, but with a labeling scheme ℓ∗ (Ui ) for its up-steps
that slightly differs from the scheme ℓ(Ui ) considered in eq. 4 for the paths of Dn . Indeed, in an histoire, for
each i, the ith up-step Ui carries an integer label
ℓ∗ (Ui ) ∈ [1, yi ],

(7)

where yi is, as before, the ordinate of the endpoint of step Ui . Note that for histoires of size n, we have yi possible
values for each label ℓ∗ (Ui ), whereas for Dyck paths in Dn , we had yi + 1 possibilities for label ℓ(Ui ).
Denote by Hn the set of histoires of size n. Section 1.2 of Roblet and Viennot (1996) found that for n ≥ 1,
|Hn | = (2n − 1)!! = (2n − 1) × (2n − 3) × . . . 3 × 1.
6

(8)

Number of taxa m
(m = 2n + 1)

3
5
7
9
11
13
15
17
19

Table 1: The number of matching coalescent histories.
Number of matching coalescent histories
Predicted by the
linear
regression
model
1
12
103
888
7,679
66,406
574,261
4,966,073
42,945,396

Exact value of
h(m−1)/2 for the
lodgepole tree
2
10
74
706
8,162
110,410
1,708,394
29,752,066
576,037,442

Upper bound for
h−
m based on “bicaterpillars”
2
10
65
481
5,544
56,628
613,470
6,952,660
81,662,152

Lower bound for h+
m
based on lodgepole
trees
2
14
138
1,663
6,237
90,090
1,447,875
25,844,568
509,233,725

Given m, we exponentiate the value from the regression model in Figure 1 and round to the nearest integer. The
exact h(m−1)/2 = hn is computed from eq. 2 or 6. For m ≤ 9, the upper bound for h−
m and the lower bound for
are
computed
exactly
from
Tables
1-4
of
Rosenberg
(2007).
For
m
≥
11,
the
upper
bound for h−
h+
m is computed
m
as cn cn+1 , with cn as in eq. 1. Applying Proposition 1 and noting that (n − 2)/n = (m − 5)/(m − 1), the lower
bound for h+
m is computed as m!! (m − 5)/(m − 1), rounding down where necessary.
We say that an histoire of size n is indecomposable if its underlying Dyck path is indecomposable (Fig. 5C). It
can be observed that, denoting by Hn′ the number of indecomposable histoires of size n, we have for n ≥ 0
′
|Dn | = |Hn+1
|.

(9)

Indeed, as depicted in Figure 5, panels B and C, each labeled Dyck path P ∈ Dn can be bijectively mapped onto
′
that is obtained by adding an up-step U labeled with the integer 1 and a down-step
a labeled path P ′ ∈ Hn+1
D respectively at the beginning and at the end of P and keeping unchanged the labels of the remaining up-steps
of P . In symbols, we have for n ≥ 0 the bijective correspondence
′
P ∈ Dn ⇔ U P D = P ′ ∈ Hn+1
.

(10)

Note in fact that according to the labeling scheme ℓ∗ for histoires (eq. 7), in P ′ only the label ℓ∗ (U1 ) = 1 is
possible for the new first up-step U1 . The up-step U1 has ordinate 1. Furthermore, for all i with 1 ≤ i ≤ n, the
′
ordinate yi+1
of the (i + 1)th up-step in P ′ satisfies
′
yi+1
= yi + 1,

where yi is the ordinate of the ith up-step in P . Therefore, keeping the labels of the up-steps of P unchanged,
the labeling scheme ℓ∗ for the histoires is satisfied by P ′ , as can be seen by comparing eq. 4 and eq. 7. Finally,
by construction, the path P ′ touches the x-axis only in the extreme points and is by definition indecomposable.
By the bijection in eq. 10, we thus have eq. 9.
Combining eqs. 5 and 9, we obtain for n ≥ 0
′
hn = |Hn+1
|.

(11)

′′
can
We denote by Hn′′ the set of decomposable (not indecomposable) histoires of size n ≥ 1. An histoire in Hn+1
′
be decomposed uniquely as a concatenation of an indecomposable histoire in Hn+1−k for some k, 1 ≤ k ≤ n, and

7

first return

possibly empty

Hn +1

=

not empty

Hn +1 −k

Hk

′′
Figure 6: A decomposition of a decomposable histoire d’Hermite. Any decomposable histoire in Hn+1
for n ≥ 1 is uniquely

′
obtained by concatenating an indecomposable histoire in Hn+1−k
with 1 ≤ n + 1 − k ≤ n (Fig. 5C) and an histoire in Hk
with 1 ≤ k ≤ n. The point at which they touch corresponds to the first return to the x-axis of the entire path. The shading
indicates that the indecomposable histoire on the left begins with an up-step, ends with a down-step, and does not reach
the x-axis within the shaded trapezoid.

a second histoire that is either decomposable or indecomposable and hence lies in Hk (Fig. 6). The endpoint
′
′′
to the
of the indecomposable histoire in Hn+1−k
provides the first return of the decomposable histoire in Hn+1
x-axis, after which the histoire in Hk might or might not touch the x-axis at a point in its interior.
Applying the decomposition, we have for n ≥ 1
′′
|Hn+1
|

=

n
X
k=1

′
|Hn+1−k
| |Hk |.

Because the number of histoires in Hn is known from eq. 8, and because each histoire is either decomposable or
indecomposable, we obtain a recursion for the number of indecomposable histoires of size n + 1:
′
′′
|
|Hn+1
| = |Hn+1 | − |Hn+1
n
X
′
= (2n + 1)!! −
| |Hk |
|Hn+1−k
k=1

= (2n + 1)!! −

n
X
k=1

′
|Hn+1−k
| (2k − 1)!!.

By eq. 11, we have demonstrated eq. 6.
The fact that hn can be computed as in eq. 6 shows that the matching coalescent histories of λn are equinumerous with other combinatorial structures. In particular, in addition to being the number of coalescent histories
for lodgepole trees and the number of indecomposable histoires d’Hermite of size n + 1, hn appears in enumerating topologically distinct Feynman diagrams of order n (Jacobs, 1981; Battaglia and George, 1988), as well as in
counting for an alphabet of size n + 1 a class of “irreducible” words in which each letter appears exactly twice,
and in which the first appearances of the letters appear in a canonical order (Burns and Muche, 2011).

3.4

Asymptotic behavior of hn and its consequences

We now turn to using our recursion in eq. 6 to determine asymptotic properties of the number hn of matching
coalescent histories for lodgepole species trees. From eq. 6, it immediately follows for n ≥ 0 that
hn ≤ (2n + 1)!!.

8

(12)

Therefore, dividing both sides of eq. 6 by (2n+1)!!, for n ≥ 1, we can write
n−1

n−1

k=0

k=0

X (2k + 1)!!
X (2k + 1)!! [2(n − 1 − k) + 1]!!
hn
1≥
=1−
hn−1−k ≥ 1 −
.
(2n + 1)!!
(2n + 1)!!
(2n + 1)!!

(13)

The final step in eq. 13 follows by replacing hn−1−k with the upper bound [2(n − 1 − k) + 1]!! from inequality 12.
Using the fact that
(2n + 1)!
,
(14)
(2n + 1)!! =
2n n!
the sum in eq. 13 can be simplified as

n−1
X (2k + 1)!! [2(n − 1 − k) + 1]!! n−1
X n+1
k+1
sn =
=
(15)
2n+2 .
(2n + 1)!!
2k+2
k=0

k=0

For n = 1, we have s1 = 13 . In the Appendix, we show that for n ≥ 1, the sequence (sn )n≥1 satisfies the recursion
(2n + 3)sn+1 = (n + 2)sn + 1.
For n ≥ 1, the upper bound

(16)

2
(17)
n
13
, inequality 17 holds for n = 1, 2, 3. By eq. 16,
can be verified by induction. Because s1 = 31 , s2 = 25 , and s3 = 35
the inductive hypothesis yields (2n + 3)sn+1 ≤ 2(n + 2)/n + 1 = (3n + 4)/n, so that
sn ≤

sn+1 ≤

3n + 4
2
≤
,
n(2n + 3)
n+1

where the latter inequality holds for n ≥ 3.
Therefore, from inequalities 13 and 17, we have for n ≥ 1
1−

hn
2
≤ 1 − sn ≤
≤ 1,
n
(2n + 1)!!

which finally gives the bounds
(2n + 1)!!



n−2
n



≤ hn ≤ (2n + 1)!!,

and the asymptotic relationship hn ∼ (2n + 1)!!. We summarize our results in a proposition.
Proposition 1 The number hn of matching coalescent histories for the lodgepole family (λn )n≥0 is
hn = (2n + 1)!! −

n−1
X

(2k + 1)!! hn−1−k ,

(18)

k=0

where we set h0 = 1. The following bounds hold for n ≥ 1:


n−2
(2n + 1)!!
≤ hn ≤ (2n + 1)!!,
n
and asymptotically, we have
hn ∼ (2n + 1)!! ∼

√

9



2(n + 1)
2
e

n+1

.

(19)

(20)

√
The asymptotic approximation in eq. 20 follows from Stirling’s approximation n! ∼ 2πn(n/e)n and from
an equivalent form of eq. 14, (2n + 1)!! = (2n + 2)!/[2n+1 (n + 1)!]. By Proposition 1, using an odd number
m = 2n + 1 describing the number of taxa in the lodgepole species tree λn , we have the following corollary.
Corollary 1 There exists a family of species trees whose number of matching coalescent histories grows faster
than exponentially in the number of taxa m. In particular, when m is odd, the number of matching coalescent
histories for the lodgepole species tree λ(m−1)/2 with m ≥ 1 leaves is asymptotically
h(m−1)/2 ∼ m!! ∼

√

2

r

m+1
e

!m+1

.

(21)

Rosenberg (2007) studied the variability across all species trees for a fixed number of taxa m of the number
of matching coalescent histories by examining a ratio
R(m) =

h+
m
,
h−
m

where h+
m denotes the number of coalescent histories for the m-taxon species tree with the greatest number of
−
matching coalescent histories and h−
m denotes the corresponding value for the smallest number of histories (hm ).
In Theorem 3.18, Rosenberg (2007) reported a lower bound on R(m) for m ≥ 2:
 √ 

√
π
5m − 12
R(m) ≥
(22)
m m.
32
4m − 6
Our computations with lodgepole species trees substantially increase the lower bound for h+
m . By using inequality 19, we can improve on the lower bound on R(m) for the case of m odd.
−
Corollary 2 Let R(m) = h+
m /hm denote the ratio of the numbers of matching coalescent histories for the mtaxon species trees with the greatest and smallest numbers of coalescent histories. Then, for odd m ≥ 7,
√
m
m−1
√
R(m) ≥
.
(23)
4 e

Proof. Because m is odd, we fix m = 2n+1 and switch between indexing by m and by n. First, for h−
m , Rosenberg
(2007) considered a “bicaterpillar” tree from whose root descended two caterpillar subtrees, with ⌊m/2⌋ = n and
⌈m/2⌉ = n + 1 taxa. This tree has cn cn+1 histories (Rosenberg, 2007, Theorem 3.10), where cn is the Catalan
number as in eq. 1, so that h−
m ≤ cn cn+1 .
Now, for h+
,
we
use
the
lodgepole
species tree λn with m = 2n + 1 leaves to provide a lower bound on the
m
number of matching coalescent histories for the tree with the largest number of matching coalescent histories, so
that h+
m ≥ hn . By inequality 19,


n−2
+
hm ≥ hn ≥ (2n + 1)!!
.
n
Therefore, with cn as in eq. 1,
(2n + 1)!!
h+
m
≥
R(m) = −
cn cn+1
hm



n−2
n



=

(2n + 1)(n − 2)(n + 1)(n + 2)
2n n

10

n!

2n+2 ,
n+1

R(m) ≥
=

√

2πn(n/e)n and noting that
√
(2n + 1)(n − 2)(n + 1)(n + 2) 2πn(n/e)n
n+1
2n n
√ 4  n
(2n + 1)(n − 2)(n + 1)(n + 2) 2πn n
.
4n
8e

where we have again used eq. 14. Using the Stirling bound n! ≥

2n
n

Substituting n = (m − 1)/2 in inequality 24 to consider the number of taxa m = 2n + 1 yields
√
m
√
eπm(m − 5)(m + 1)(m + 3)
m−1
√
R(m) ≥
,
4(m − 1)
4 e
which gives, if m ≥ 7, inequality 23 (and is in fact stronger than the simpler eq. 23).

4

≤ 4n , we have

(24)

(25)



Discussion

We have defined the lodgepole family of species trees (λn )n and studied the growth of the number hn of matching
coalescent histories for λn as a function of n, showing that asymptotically, hn ∼ (2n+1)!!. For m odd, the number
h(m−1)/2 of matching coalescent histories for the lodgepole species tree with m taxa grows with m!!. Previous
enumerative results for other species tree families have found that the number of coalescent histories increases
only exponentially; we have demonstrated the existence of a family of species trees for which the number of
matching coalescent histories grows more quickly than exponentially in the number of taxa (Corollary 1).
Our results for lodgepole species trees indicate that the exponential increase in the number of matching
coalescent histories observed in Figure 1 is misleading, at least in regard to the largest numbers of matching
coalescent histories at a fixed number of taxa. We can consider the linear regression model obtained in Figure 1—
representing exponential growth—alongside an upper bound for h−
m , the smallest number of matching coalescent
histories at m taxa, and our new lower bound for h+
,
the
largest
number of matching coalescent histories at
m
m taxa (Table 1). This comparison illustrates that whereas the linear model is reasonable at the small values
of m depicted in Figure 1, it becomes increasingly unreasonable in predicting h+
m . Indeed, a consequence of
the enumeration for lodgepole families is a substantially larger lower bound for the variability of the number of
matching coalescent histories for species trees of fixed size (Corollary 2).
The lodgepole trees differ from the caterpillars in that pairs of leaves rather than single leaves are descended
from the internal nodes along the main branch. That the lodgepole species trees have such faster growth
in their number of matching coalescent histories compared to the caterpillar species trees indicates that this
apparently minor change in the branching structure of species trees leads to qualitatively different results in
the number of histories. By contrast, it has been found that certain other changes to the caterpillars, replacing
a caterpillar subtree by a non-caterpillar subtree, change the asymptotic growth in the number of matching
coalescent histories only by a change to the constant multiple of the Catalan numbers, and do not change the
overall growth rate (Rosenberg, 2007, 2013).
The results have the implication that although the numbers of coalescent histories for relatively small species
trees remain small enough for reasonable computation times involving enumerations of coalescent histories, the
most challenging cases can grow more rapidly in the number of taxa than has been suggested in the cases that
have been previously examined. It will be important to determine whether the challenging lodgepole scenario
arises in practical settings, as well as the possibility that even more challenging families exist, for which the
growth rate is even faster than in the lodgepole case.
The links in our analysis to Dyck paths and the histoires d’Hermite, and the appearance for the number of
matching coalescent histories of lodgepole species trees of a sequence arising in other counting problems, identify
known combinatorial structures to which coalescent histories can be related. These connections are promising
for additional future computations about coalescent histories.
11

Acknowledgments
We thank J. Syring for botanical advice. We acknowledge grant support from the National Science Foundation
(DBI-1146722).

Appendix
 2n+2
This appendix proves eq. 16 from eq. 15. We define for n ≥ 1 and 0 ≤ k ≤ n, F (k, n) = n+1
k+1 / 2k+2 and
R(k, n) = 2n − 2k + 1. We use F (k, n) and R(k, n) to apply the summation methods of Petkovšek et al. (1996).
It can be verified algebraically that
2(n + 2)F (k, n) − 2(2n + 3)F (k, n + 1) = F (k + 1, n)R(k + 1, n) − F (k, n)R(k, n).

(26)

Indeed, the identity follows by dividing both sides of eq. 26 by the nonzero F (k, n) and applying the ratios
F (k, n + 1)/F (k, n) = (2n − 2k + 1)/(2n + 3) and F (k + 1, n)/F (k, n) = (2k + 3)/(2n − 2k − 1). Summing both
sides of eq. 26 for k from 0 to n − 1, the right-hand side telescopes, giving a final contribution of F (n, n)R(n, n) −
F (0, n)R(0, n). Therefore, we obtain
!
" n
!
#
n−1
X
X
2(n + 2)
F (k, n) − 2(2n + 3)
F (k, n + 1) − F (n, n + 1) = F (n, n)R(n, n) − F (0, n)R(0, n).
k=0

Taking sn =

Pn−1
k=0

k=0

F (k, n) as in eq. 15 yields


1
2(n + 2)sn − 2(2n + 3) sn+1 −
2n + 3



= 0,

from which eq. 16 immediately follows.

References
Allman, E. S., J. H. Degnan, and J. A. Rhodes (2011). Identifying the rooted species tree from the distribution
of unrooted gene trees under the coalescent. J. Math. Biol. 62, 833–862.
Battaglia, F. and T. F. George (1988). A Pascal-type triangle for the number of topologically distinct manyelectron Feynman graphs. J. Math. Chem. 2, 241–247.
Burns, J. and T. Muche (2011). Counting irreducible double occurrence words. Congressus Numerantium 207,
181–196.
Degnan, J. H. (2005). Gene tree distributions under the coalescent process. Ph. D. thesis, University of New
Mexico, Albuquerque.
Degnan, J. H. and N. A. Rosenberg (2009). Gene tree discordance, phylogenetic inference and the multispecies
coalescent. Trends Ecol. Evol. 24, 332–340.
Degnan, J. H. and L. A. Salter (2005). Gene tree distributions under the coalescent process. Evolution 59, 24–37.
Dutheil, J. Y., G. Ganapathy, A. Hobolth, T. Mailund, M. K. Uyenoyama, and M. H. Schierup (2009). Ancestral
population genomics: the coalescent hidden Markov model approach. Genetics 183, 259–274.

12

Hobolth, A., O. F. Christensen, T. Mailund, and M. H. Schierup (2007). Genomic relationships and speciation
times of human, chimpanzee, and gorilla inferred from a coalescent hidden Markov model. PLoS Genet. 3,
294–304.
Hobolth, A., J. Y. Dutheil, J. Hawks, M. H. Schierup, and T. Mailund (2011). Incomplete lineage sorting patterns
among human, chimpanzee, and orangutan suggest recent orangutan speciation and widepsread selection.
Genome Res. 21, 349–356.
Jacobs, A. E. (1981). Number of Feynman diagrams in arbitrary order of perturbation theory. Phys. Rev. D 23,
1760–1763.
Knowles, L. L. and L. S. Kubatko (Eds.) (2010). Estimating Species Trees. New York: Wiley.
Liu, L., L. L. Yu, L. Kubatko, D. K. Pearl, and S. V. Edwards (2009). Coalescent methods for estimating
phylogenetic trees. Mol. Phylogenet. Evol. 53, 320–328.
Maddison, W. P. (1997). Gene trees in species trees. Syst. Biol. 46, 523–536.
Nichols, R. (2001). Gene trees and species trees are not the same. Trends Ecol. Evol. 16, 358–364.
Pamilo, P. and M. Nei (1988). Relationships between gene trees and species trees. Mol. Biol. Evol. 5, 568–583.
Petkovšek, M., H. S. Wilf, and D. Zeilberger (1996). A=B. Wellesley, MA: Peters.
Roblet, E. and X. G. Viennot (1996). Théorie combinatoire des T-fractions et approximants de Padé en deux
points. Discrete Math. 153, 271–288.
Rosenberg, N. A. (2007). Counting coalescent histories. J. Comput. Biol. 14, 360–377.
Rosenberg, N. A. (2013). Coalescent histories for caterpillar-like families. IEEE/ACM Trans. Comp. Biol.
Bioinf. 10, 1253–1262.
Rosenberg, N. A. and J. H. Degnan (2010). Coalescent histories for discordant gene trees and species trees.
Theor. Pop. Biol. 77, 145–151.
Rosenberg, N. A. and R. Tao (2008). Discordance of species trees with their most likely gene trees: the case of
five taxa. Syst. Biol. 57, 131–140.
Stanley, R. P. (1999). Enumerative Combinatorics Volume 2. New York: Cambridge University Press.
Than, C. and L. Nakhleh (2009). Species tree inference by minimizing deep coalescences. PLoS Comp. Biol. 5,
e1000501.
Than, C., D. Ruths, H. Innan, and L. Nakhleh (2007). Confounding factors in HGT detection: statistical error,
coalescent effects, and multiple solutions. J. Comput. Biol. 14, 517–535.
Than, C. V. and N. A. Rosenberg (2011). Consistency properties of species tree inference by minimizing deep
coalescences. J. Comput. Biol. 18, 1–15.
Wu, Y. (2012). Coalescent-based species tree inference from gene tree topologies under incomplete lineage sorting
by maximum likelihood. Evolution 66, 763–775.

13

