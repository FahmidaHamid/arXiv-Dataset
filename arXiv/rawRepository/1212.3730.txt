Function-Valued Traits in Evolution
Pantelis Z. Hadjipantelis ‚àó, Nick S. Jones‚Ä†, John Moriarty‚Ä°, David A. Springate¬ß, Christopher G. Knight¬ß

1

arXiv:1212.3730v1 [stat.ME] 15 Dec 2012

Abstract

Introduction

The number, reliability and coverage of evolutionary
trees are growing rapidly [1, 2]. However, knowing
organisms‚Äô evolutionary relationships through phylogenetics is only one step in understanding the evolution of their characteristics [3]. Three issues are
particularly challenging. The first is limited information: empirical information is typically only available
for extant taxa, represented by tips of a phylogenetic
tree, whereas evolutionary questions frequently concern unobserved ancestors deeper in the tree. The
second is dependence: the available information for
different organisms in a phylogeny is not independent since a phylogeny describes a complex pattern
of non-independence; observed variation is a mixture
of this inherited variation and specific variation [4].
The third is high dimensionality: the emerging literature on function-valued traits [5, 6, 7] recognises that
many characteristics of living organisms are best represented as a continuous function rather than a single
factor or a small number of correlated factors. Such
characteristics include growth or mortality curves [8],
reaction-norms [9] and distributions [10], where the
increasing ease of genome sequencing has greatly expanded the range of species in which distributions
of gene [11] or predicted protein [12] properties are
available. Therefore, a function-valued trait is defined as a phenotypic trait that can be represented
by a continuous mathematical function [9].
Previous work [13] proposed an evolutionary model
for function-valued data d related by a phylogeny T.
The data are regarded as observations of a phylogenetic Gaussian Process (PGP) at the tips of T.
That work shows that a PGP can be expressed as a
stochastic linear operator X on a fixed set œÜ of basis
functions (independent components of variation), so
‚àó Centre for Complexity Science and Department of Statisthat
tics, University of Warwick, Coventry CV4 7AL, UK
d = XT œÜ
(1)
‚Ä†
Many biological characteristics of evolutionary interest are not scalar variables but continuous functions.
Given a dataset of function-valued traits generated
by evolution, we develop a practical statistical approach to infer ancestral function-valued traits, and
estimate the generative evolutionary process. We do
this by combining dimension reduction and phylogenetic Gaussian process regression, a nonparametric
procedure which explicitly accounts for known phylogenetic relationships. We test the methods‚Äô performance on simulated function-valued data generated
from a stochastic evolutionary model. The methods
are applied assuming that only the phylogeny and the
function-valued traits of taxa at its tips are known.
Our method is robust and applicable to a wide range
of function-valued data, and also offers a phylogenetically aware method for estimating the autocorrelation
of function-valued traits.
Keywords:
comparative analysis; OrnsteinUhlenbeck process; non-parametric Bayesian inference; functional phylogenetics; ancestral reconstruction; functional Gaussian process regression
Abbreviations:
ICA: Independent Components Analysis
IPCA: Independent Principal Components Analysis
MLE: Maximum Likelihood Estimator
OU: Ornstein-Uhlenbeck
PCA: Principal Components Analysis
PGP: Phylogenetic Gaussian Process
PGPR: Phylogenetic Gaussian Process Regression

Department of Mathematics, Imperial College London,
SW7 2AZ
‚Ä° School of Mathematics, University of Manchester, Oxford
Road, Manchester M13 9PL, UK
¬ß Faculty of Life Sciences, University of Manchester, Oxford
Road, Manchester M13 9PT, UK

However, the study does not address the linear inverse problem of obtaining estimates œÜÃÇ and XÃÇ of œÜ
and X: our first contribution in this paper is to provide an approach to this problem in section 2.2 via
1

independent principal components analysis (IPCA
[14]).
We refer to X as the mixing matrix, and to the
(i, j)th entry of X as the mixing coefficient of the ith
basis function at the jth taxon. It is these mixing
coefficients that we model as evolving. For each fixed
value of i, the Xij are correlated (due to phylogeny)
as j varies over the taxa; the basis functions themselves do not evolve in our model.
In section 2.3 we address the problem of estimating
the statistical structure of the mixing coefficients by
performing phylogenetic Gaussian process regression
(PGPR) on each of the rows of XÃÇ separately. This
corresponds to assuming independence between the
rows (i.e. that the coefficients of the different basis
functions evolve independently). It is commonly argued in the quantitative genetics literature [15] that
evolutionary processes can be modelled as OrnsteinUhlenbeck (OU) processes. Under these assumptions
the estimation of the forward operator reduces to the
estimation of a small vector Œ≥ of parameters [13].
In section 2.1 we clarify the interpretation of these
parameters in evolutionary contexts. The explicit
PGPR posterior likelihood function is then used to
obtain maximum likelihood (MLE) estimates for Œ≥.
The estimation of Œ≥ is known to be a challenging statistical problem [16]. We suggest an approach based
on the principal of bagging [17] in section 2.4.
Our final contribution (section 2.5) addresses the
problem of estimating the function-valued traits of
ancestral taxa. The PGPR step above also returns
a posterior distribution for the mixing coefficient of
each basis function at each ancestral taxon in the phylogeny. At any particular ancestor the estimated basis functions may be combined statistically, using the
posterior distributions of their respective mixing coefficients, to provide a function-valued posterior distribution. Since the univariate posterior distributions
are Gaussian, and the mixing is linear, the posterior for the function-valued trait has a closed form
representation as a Gaussian process (Eq. 7) which
provides a major analytical and computational advantage for the approach. We can verify the methods proposed by using a PGP as a stochastic generative model. This simulates correlated function-valued
traits across the taxa of T. Given only the phylogeny
and the function-valued traits of taxa at its tips, our
estimates for œÜÃÇ and the ancestral functions are then
compared to the simulation.
Overall, our three methods (in 2.2, 2.4, 2.5) appropriately combine developments in functional data

analysis with the evolutionary dynamics of quantitative phenotypic traits, allowing nonparametric
Bayesian inference from phylogenetically correlated
function-valued traits. An outline of the framework
presented in the current work can be found in Fig. 1.

Figure 1: The three methods presented in this paper
(ovals) and their interrelationships.

2

Methods & Implementation

2.1

Artificial evolution of functionvalued traits

We begin by generating a random phylogenetic tree
T with 128 tips, shown in Fig. 2. This fixes the
experimental design for our simulation and inference,
but further simulations given in the Supplementary
Material confirm that the statistical performance of
our methods is consistent across a range of choices
for bf T . Branch length distributions are surprisingly
consistent across organisms [18]; branch lengths were
drawn from the empirical branch length distribution1
extracted from TreeFam 8.0 [2].
Secondly we chose a basis œÜ in Eq. 1. We have
no reason a priori to suppose that this basis is or1 See

2

Supplementary Material section 1

Mixed sample

y
‚àí4

‚àí20

‚àí2

0

0

y

2

10

4

20

6

30

Original Basis

0.2

0.4

0.6

0.8

1.0

0.0

0.4

0.6

0.8

Principal components

Independent
Principal components

1.0

4
2
y
0
‚àí4

‚àí4

‚àí2

0

y

2

4

6

x

‚àí2

Figure 2: The random phylogenetic tree used & examples of the function-valued traits shown at the tips
(extant taxa) and the internal nodes (ancestral taxa).
A subset of these is used in Fig. 5.

0.2

x

6

0.0

0.0

0.2

0.4

0.6
x

0.8

1.0

0.0

0.2

0.4

0.6

0.8

1.0

x

Figure 3: From Top Left: Original Basis signals, œÜ;
thogonal and, in general, there is no reason for our Mixed Sample at the tips, d (four individual functioninference procedure to be sensitive to the particular valued traits are shown; red line and grey band show
shape of the basis functions. The three simple non- respectively the mean and two standard deviations
orthogonal, unimodal functions shown in Fig. 3 were for all 128 function-valued data at the tips); IPCA
therefore chosen as examples. For computational pur- Basis, œÜÃÇ; PCA Basis.
poses each basis function was stored numerically as a
vector of length 1024, so that the basis matrix œÜ was
of size 3 √ó 1024 and its ith row stored the ith basis phylogenetic) variation was added to each entry of
X i:
function.
Xi = X i + i
Thirdly, different mixing coefficients were generated by a phylogenetic OU process for each basis where i is a 1 √ó 128 vector of independent Gausfunction and stored in the respective row of X. Our sian errors with mean 0 and variance œÉni and finally
modelling assumption is that the mixing coefficients the matrix multiplication in Eq. 1 was performed to
for distinct basis functions œÜ1 , œÜ2 , œÜ3 are statistically obtain the simulated data d. The ‚Äòextant‚Äô
P3 functionindependent of each other: in Eq. 1 this means that valued trait at tip taxon j is thus
i=1 Xij œÜi (a
functionthe rows of X are independent. It is therefore suf- vector of length 1024), while the ancestral
P3
ficient to describe the stochastic process generating valued trait at internal taxon g is i=1 Wig œÜi . The
Xi , the ith row of X with i ‚àà {1, 2, 3}. We calculated ancestral function-valued traits therefore exhibit only
the mixing matrix at the 128 tip taxa so X is of size the phylogenetic part of simulated variation, while
3 √ó 128. The ‚Äútrue‚Äù ancestral values were established the extant function-valued traits exhibit both phyloby generating phylogenetic Ornstein-Uhlenbeck (OU) genetic and non-phylogenetic variation. Of course, it
processes over the whole phylogeny. The values of is not possible to reconstruct non-phylogenetic variathis process at tip taxa were stored in a row vector tion using phylogenetic methods: we simulate nonX i (X i is a simulation of the tip taxa mixing coef- phylogenetic variation only to demonstrate that it
ficients Xi excluding the non-phylogenetic variation) does not prevent the reconstruction of the phylogeand its values at internal taxa were stored in a row netic part of variation for ancestral taxa in sections
vector Wi for performance analyses in section 2.5. 2.2 to 2.5.
To simulate the additional effect of non-phylogenetic
We now comment on the specific parameters chovariation (due, for example, to measurement error sen for the phylogenetic OU processes above. As in
or environmental effects), independent (that is, non- [19] we refer to the strength of selection parameter Œ±
3

2.2

and the random genetic drift œÉ: we add superscripts
to these parameters to distinguish between the three
different OU processes. With this notation, the mixing coefficients for the row Xi have the following covariance function :
i
KT
(t1 , t2 ) =E[Xij Xig ]

Given a dataset d of function-valued traits, we would
like to find appropriate estimates XÃÇ and œÜÃÇ of the mixing matrix X and the basis set œÜ respectively. The
first task is to identify a good linear subspace S of
the space of all continuous functions by choosing basis functions appropriately. The purpose is to work,
not with the function-valued data directly, but with
their projections in S. We may say that the chosen
subspace S is good if the projected data approximate
the original data well while the number of basis functions is not unnecessarily large, so that S has the
‚Äòeffective‚Äô dimension of the data.

(2)


=(œÉfi )2 exp ‚àí2Œ±i DT (tj , tg ) + (œÉni )2 Œ¥tej ,tg
q
(œÉ i )2
where œÉfi =
2Œ±i , DT (tj , tg ) denotes the phylogenetic or patristic distance (that is, the distance in
T) between the jth and gth tip taxa, œÉn is defined as
above, and
Œ¥tej ,tg


=

1
0

iff tj = tg and tj is a tip taxon,
otherwise

We then face a linear inverse problem: given the
dataset d of function-valued traits, the task is to generate estimates XÃÇ and œÜÃÇ (Eq. 1). This task is also
known as source separation [21], which has a variety of implementations making different assumptions
about the basis œÜ and mixing coefficients X. One
widely used approach is PCA [22], which returns orthogonal sets of basis functions to explain the greatest possible variation. PCA has been extended to
take account of phylogenetic relationships [23], however, if a sample of functions is generated by mixing
non-orthogonal basis functions, the principal components of the sample (whether or not they account
for phylogeny) will not equal the basis curves, due
to the assumption of orthogonality: see Fig. 3. In
independent components analysis (ICA), the alternative assumption is made that the rows Xi of X are
statistically independent. This assumption fits more
naturally with our modelling assumptions, since we
assume that the rows Xi are mutually independent
[21]. ICA has proved fruitful in other biological applications [24] as has passing the results of PCA to
ICA, which has been termed IPCA [14].

adds non-phylogenetic variation to extant taxa as discussed above, ie. Œ¥ e evaluates to 1 only for extant
taxa, thus œÉn quantifies within-species genetic or environmental effects and measurement error in the ith
mixing coefficient. We see from Eq. 2 that the proportion of variation in the row Xi attributable to the
phylogeny is

(œÉfi )2
i )2 .
(œÉfi )2 +(œÉn

In the Gaussian process regression literature in Ma1
is equivalent to `, the characterischine Learning, 2Œ±
tic length-scale [20] of decay in the correlation function and in the following we work with the latter.
For all of the OU processes we used characteristic
length scales relative to 8.22, the maximum patristic
distance (`max ) between two extant taxa for our simulated tree (Fig. 2). The values we used are given
in Table 1. In particular, œÉfi = 0 when i = 2 and it
follows that the characteristic length scale ` plays no
role for this OU process, and equally we do not define
the strength-of-selection parameter Œ±i when i = 2.
i
1
2
3

œÉfi
2.5
0
1.5

`i
6.17
NA
2.06

Dimensionality reduction and
source separation for functionvalued traits

œÉni
.5
1
.5

PCA is an appropriate tool for identifying the effective dimension of a high-dimensional dataset [25].
So, to achieve both dimension reduction and source
Table 1: The fixed values used for the parameters in separation, we first applied PCA to the dataset d (the
Eq. 2 to generate the mixing coefficients Xij . Each 128 function-valued traits at the tips of T) to deterrow constitutes a value of Œ≥ i . 6.17 & 2.06 correspond mine the appropriate number of basis functions. The
to .75 and .25 of the tree‚Äôs `max respectively. When principal components were then passed to the Cui = 2, `i is not applicable since there is no phyloge- bICA implementation of ICA [26]. CubICA returned
netic variation in the sample.
a new set of basis functions (Fig. 3, lower-right panel)
which were taken as the estimated basis œÜÃÇ.
4

2.3

Phylogenetic Gaussian process re- It can be seen from Eq. 6 that the maximum likelihood estimate is subject both to the fit it delivgression
ers (the first term) and the model complexity (the
second term). Thus, Gaussian process regression is
non-parametric in the sense that no assumption is
made about the structure of the model: the more
data gathered, the longer the vector f (x), and the
more intricate the posterior model for f (x‚àó ).
PGPR extends the applicability of GPR to evolved
function-valued traits. A phylogenetic Gaussian process is a Gaussian process indexed by a phylogeny T,
where the function-valued traits at each pair of taxa
are conditionally independent given the functionvalued traits of their common ancestors. When the
evolutionary process has the same covariance function along any branch of T beginning at its root
(called the marginal covariance function), these assumptions are sufficient to uniquely specify the covariance function of the PGP, KT . As we assume
that T is known in our inverse problem, the only remaining modelling choice is therefore the marginal
covariance function. As can be seen from Eq. 2, K
is a function of patristic distances on the tree rather
than Euclidean distances as standard in spatial GPR.
In comparative studies, where one has observations
at the tips of T, the covariance function KT may be
used to construct a Gaussian process prior for the
function-valued traits, allowing functional regression.
In the model that we use this is equivalent to specifying a Gaussian prior distribution for the mixing
coefficients Yij and Xij . This may be done by regarding the row vectors Yi and Xi as observations of
a univariate PGP. As noted in [13], if we assume that
the evolutionary process is Markovian and stationary
then the modelling choice vanishes and the marginal
covariance function is specified uniquely: it is the stationary OU covariance function. If we also add explicit modelling of non-phylogenetically related variation at the tip taxa, the univariate prior covariance
function has the unique functional form presented in
Eq. 2. We do not assume knowledge of the parameters of Eq. 2 however: their estimation is the subject
of the next section.

ICA also returns the estimated mixing coefficients at
tip taxa, XÃÇ. Our next step was to perform PGPR
[13] separately on each row XÃÇi , assuming knowledge
of the phylogeny T, in order to obtain posterior distributions for all mixing coefficients throughout the
tree T.
Gaussian process regression (GPR) [20] is a flexible
Bayesian technique in which prior distributions are
placed on continuous functions. Its range of priors includes the Brownian motion and Ornstein-Uhlenbeck
(OU) processes, which are by far the most commonly
used models of character evolution [27, 15]. Its implementation is particularly straightforward since the
posterior distributions are also Gaussian processes
and have closed forms. We now give a brief exposition of GPR, using notation standard in the Machine
Learning literature (see, for example, [20]).
A Gaussian process may be specified by its mean
surface and its covariance function K(Œ≥), where Œ≥ is
a vector of parameters. Since the components of Œ≥
parameterise the prior distribution, they are referred
to as hyperparameters. The Gaussian process prior
distribution is denoted
f ‚àº N (0, K(Œ≥))
If x‚àó is a set of unobserved coordinates and x is a
set of observed coordinates, the posterior distribution
of the vector f (x‚àó ) given the observations f (x) is
f (x‚àó )|f (x) ‚àº N (A, B)

(3)

where
A =K(x‚àó , x, Œ≥)K(x, x, Œ≥)‚àí1 f (x),
‚àó

(4)

‚àó

B =K(x , x , Œ≥)
‚àíK(x‚àó , x, Œ≥)K(x, x, Œ≥)‚àí1 K(x‚àó , x, Œ≥)T
‚àó

(5)

‚àó

and K(x , x, Œ≥) denotes the |x | √ó |x| matrix of the
covariance function K evaluated at all pairs x‚àói ‚àà
X ‚àó , xj ‚àà X. Equations 4 and 5 convey that the posterior mean estimate will be a linear combination of
the given data and that the posterior variance will
be equal to the prior variance minus the amount that
can be explained by the data. Additionally, the loglikelihood of the sample f (x) is

2.4

Hyperparameter estimation

Since the posterior distributions returned by PGPR
depend on the hyperparameter vector Œ≥, we must estimate Œ≥ in order to reconstruct ancestral functionvalued traits, and the estimation procedure should
correct for the dependence due to phylogeny. Maximum likelihood estimation (MLE) of the phylo-

1
log p(f (x)|Œ≥) = ‚àí f (x)T K(x, x, Œ≥)‚àí1 f (x)
2
1
|x|
‚àí log(det(K(x, x, Œ≥))) ‚àí
log 2œÄ.
2
2
(6)
5

(œÉ )2

genetic variation, non-phylogenetic variation and
characteristic-length-scale hyperparameters œÉfi , œÉni
and `i respectively may be attempted numerically using the explicit prior likelihood function (Eq. 6). Because estimating œÉfi and `i alone is challenging [16]
(although the estimation improves significantly with
increased sample size), and we have further increased
the challenge by introducing non-phylogenetic variation, we propose an improved estimation procedure
using the machine learning technique bagging [17],
which a member of the boosting framework [22]. We
show that these estimates may be further improved
(œÉ )2
if one knows the value of the ratio (œÉnf )2 , which is
closely related to Pagel‚Äôs Œª [28].
Bagging (bootstrap aggregating) seeks to reduce
the variance of an estimator by generating multiple
estimates and averaging. It is simple to implement
given an existing estimation procedure: one adds a
loop front end that selects a bootstrap sample and
sends it to the estimation procedure and a back end
that aggregates the resulting estimates [17]. We generated 100 (sub)trees of 100 taxa by sampling without
replacement our original 128 taxa tree, obtained the
MLE for Œ≥ on each subtree, and averaged these estimates to obtain the aggregated estimate Œ≥ÃÇ. Our results are shown in Table 2: for i = 1 and i = 3, given
our moderate sample size (128 taxa), the accuracy of
these results is at least in line with the state of the
art [16] despite the additional challenge posed by nonphylogenetic variation. For i = 2, where phylogenetic
variation is absent from the generative model (œÉfi =0),
our estimation procedure indicates its absence by returning estimates for `i whose magnitude is unrealistically small for the examined tree (less than the
1st percentile of the tree‚Äôs patristic distances). Commenting further on this matter, exceptionally small
characteristic length-scales relative to the tree patristic distances, as seen here, practically suggest taxaspecific phylogenetic variation, ie. non-phylogenetic
variation. This holds also in its reverse: exceptionally large characteristic length-scales suggest a stable,
non-decaying variation across the examined taxa that
is indifferent to their patristic distances, again suggesting the absence of phylogenetic variance among
the nodes.
To assess the robustness of this hyperparameter estimation method we performed 1024 simulations, randomly regenerating the tree and parameter vector Œ≥
each time2 . The accuracy of these estimates is shown
2 See

in Fig. 4. Improved results when the ratio (œÉnf )2 is
known a priori (for example, through knowledge of
Pagel‚Äôs Œª) are also given in the supplementary material (Sect. 2 & 3). Our ultimate aim is ancestor reconstruction rather than hyperparameter estimation
per se, and this is the subject of the next section.
i
1
2
3

œÉÃÇfi
3.41 (.62)
0.55 (.33)
2.83 (.33)

`ÀÜi
2.83 (.47)
0.05 (.02)
2.06 (.50)

œÉÃÇni
0.78 (.47)
0.84 (.34)
0.73 (.29)

Table 2: The bagging estimates for the hyperparameters in Eq. 2 (standard deviations of bagging estimates in parentheses). Each row corresponds to a
given estimate of the vector Œ≥ÃÇ i . These estimates provide the maximum likelihood value for Eq. 6 and are
comparable with the original ones from Table 1.

2.5

Ancestor reconstruction

Having generated function-valued data (Sect. 2.1),
extracted mixing coefficients XÃÇ (Sect. 2.2) and performed hyperparameter estimation (Sect. 2.4), we
may now perform PGPR (Sect. 2.3) on each row XÃÇi ,
to obtain the univariate Gaussian posterior distribution for the mixing coefficient Wit‚àó at any internal
taxon t‚àó . As discussed in Sect. 2.3, the Gaussian process prior distribution has covariance function (Eq.
2). We have assessed the accuracy of our bagging estimate Œ≥ÃÇ in Sect. 2.4 and we now substitute Œ≥ÃÇ i into
Eq. 2. Taking a simple and direct approach, our estimate œÜÃÇ obtained in Sect. 2.2 may then be substituted
into Eq. 1 to obtain the function-valued posterior distribution ft‚àó for the function-valued trait at taxon t‚àó .
Since our estimated basis functions are stored numerically as vectors of length 1024, this gives the same
discretision for the ancestral traits.
Conditioning on our estimated mixing coefficients
XÃÇi for the tip taxa, the posterior distribution of Wit‚àó
is
Wit‚àó ‚àº N (AÃÇi , BÃÇi )
where the vector AÃÇi and matrix BÃÇi are obtained from
Eq.‚Äôs 4 and 5, taking x = XÃÇi , x‚àó = Wit‚àó and Œ≥ÀÜi
respectively for our observation coordinates, estimation coordinates and hyperparameter vector. Since
our prior assumption is that the rows of X are statistically independent of each other, it follows from Eq.

Supplementary Material section 2

6

l

œÉn

‚àí2

‚àí1

0

1

2

1.5
Density

0.0

0.5

1.0

1.5
Density

0.0

0.5

1.0

1.5
1.0
0.0

0.5

Density

2.0

^ n ‚àí œÉn
œÉ

2.0

^
l ‚àíl

œÉf
2.0

^ f ‚àí œÉf
œÉ

‚àí2

Relative Error

‚àí1

0

1

Relative Error

2

‚àí2

‚àí1

0

1

2

Relative Error

Figure 4: Kernel Density estimates of the relative errors in 1024 runs of the Œ≥ estimation procedure, each time
for a different tree, a different set of mixing coefficients and a different set of parameters in Œ≥; no components
of Œ≥ are assumed to be known beforehand. Estimation results are commented on in the Discussion. The
median values shown by the dotted line are (-0.073, -0.131 and 0.001) respectively.
1 that
ft‚àó ‚àº N (Œ£ki=1 AÃÇi œÜÃÇi , Œ£ki=1 œÜÃÇTi BÃÇi œÜÃÇi )

d, the challenge is to infer a forward operator G and
model œÜ such that:
(7)
d = G(œÜ)

The marginal distributions of this representation
(mean and standard deviation) are shown in Fig. 5.
Fig. 5 compares the function-valued estimates fÀÜt‚àó
to the simulated function-valued traits at the root
(left panel), an internal node (centre), and at a tip
(right panel). In the centre and left panels the simulated function-valued data is shown in black, and
can be seen typically to lie within two posterior standard deviations. In the right panel, the black line
is the observed function-valued trait at that tip: the
red line and dark grey band represent the posterior
distribution of its phylogenetic component, and the
light grey band represents the estimated magnitude
of the additional non-phylogenetic variation. Uncertainty over the phylogenetic part of variation (dark
grey band) decreases from root to tip, as all observations are at the extant tip taxa. We note that the
posterior distributions, even at the root, put clear
statistical constraints on the phylogenetic part of ancestral function-valued data: in this (admittedly simulated and highly controlled) setting we can reason
effectively about ancestral function-valued traits.

(8)

and such problems are typically under-determined
and require additional modelling assumptions [29].
Given a phylogeny T and function-valued data d at
its tips, we wish to infer the forward operator GT and
model œÜ such that
d = GT (œÜ)

(9)

When the data d are a small number of correlated factors per tip taxon, a variety of statistical approaches are available (e.g. see [30], [31]). When the
data are functions, the phylogenetic Gaussian processes (PGP) [13, 32] has been proposed as the forward operator and this is the approach we have taken
in this work.
Our dimensionality reduction methodology in Sect.
2.2 can be easily varied or extended. For example,
any suitable implementation of PCA may be used
to perform the initial dimension reduction step: in
particular, if the data have an irregular design (as
happens frequently with function-valued data), the
method of Yao et al. [33] may be applied to account
for this; the ICA step then proceeds unchanged. We
also note that while we find the CubICA implementa3 Discussion
tion of ICA to be the most successful in our signal sepIn Sec. 2.1 we have appealed to Eq. 1 in the setting aration task, other implementations like FastICA [21]
of mathematical inverse problems where, given data or JADE [34] can also be employed. In general, ICA
7

0.0

0.2

0.4

0.6
x

0.8

1.0

10
5
y

‚àí10

‚àí5

0

5
‚àí10

‚àí5

y

0

5
0
‚àí10

‚àí5

y

Tip Estimate

10

Node Estimate

10

Root Estimate

0.0

0.2

0.4

0.6

0.8

1.0

0.0

0.2

0.4

x

0.6

0.8

1.0

x

Figure 5: Posterior distributions at three points in the phylogeny using the estimated œÜÃÇ and Œ≥ÃÇ. The prediction
made by the regression analysis is shown via the posterior mean (red line), the component of posterior
variance due to phylogenetic variation (two standard deviations, dark grey band) and non-phylogenetic
variation (two standard deviation, light grey band). The black line shows the simulated data enabling visual
validation of the ancestral predictions. In the right panel, the black line is the training data at a tip taxon
the red line and dark grey band represent the posterior distribution of its phylogenetic component, while the
light grey band represents the estimated magnitude of non-phylogenetic variation. The root and internal
taxon here are the same as those indicated in Fig.2 & 3, and the tip is the second from bottom on the same
figure.
gives rows XÃÇi of the estimated mixing matrix that
are maximally independent under a particular measure of independence involving, for example, higher
sample moments or mutual information, in order to
approximate the solution of the inverse problem in
Eq. 1 under our assumption of independence between
the rows of X. PCA and ICA have different purposes (respectively, orthogonal decomposition of variation and separation of independently mixed signals)
and we employ them sequentially in IPCA. IPCA is
nonparametric and, in particular, both distributionally and phylogenetically agnostic. This means that
unlike PCA, IPCA is robust to non-Gaussianity in
the data and, unlike phylogenetically corrected PCA,
IPCA is robust to mis-specification of the phylogeny
and to mixed phylogenetic and non-phylogenetic variation in the data: any of these can be features of
biological data.

bagging in order to bootstrap our sample. Somewhat unintuively, bagging ‚Äúworks‚Äù exactly because
the subsample Œ≥ÃÇ estimates are variable and thus we
avoid overfitted final estimates3 . Conceptually our
work on hyperparameter estimation, when taken together with Sec. 2.2, relates to the character process
models of [36] and orthogonal polynomial methods of
[37], which give estimates for the autocovariance of
function-valued traits. Writing out Eq. 1 for a single
function-valued trait (at the jth tip taxon, say), our
model may be viewed as
f (x) =

3
X
i=1

gij œÜi (x) +

3
X

eij œÜi (x)

(10)

i=1

where the mixing coefficient Xij has been expressed
as the sum of gij , the genetic (i.e. phylogenetic) part
of variation, plus eij , the non-phylogenetic (eg. environmental) part of variation, just as in these refIt can be seen in Fig. 4 that the estimation of ` erences. Then the autocorrelation of the functionis more challenging than the estimation of œÉn or œÉf , valued trait is
having greater bias and variance. This corresponds
3 

X
to the documented difficulty of estimating the paramf 2
n 2
E[f
(x
)f
(x
)]
=
(œÉ
)
+
(œÉ
)
œÜi (x1 )œÜi (x2 )
1
2
i
i
eter Œ± in the Ornstein-Uhlenbeck model, particularly
i=1
for smaller sample sizes. Our work on hyperparam(11)
eter estimation in Sec. 2.4 mitigates these difficul3 See Supplementary Material Section 2
ties due to small sample size [16, 35] by employing
8

The estimates of œÉif and œÉin obtained in section 2.4
[6] ‚ÄùThe Functional Phylogenies Group‚Äù. Phylogemay be substituted into Eq. 11 to obtain an estimate
netic inference for function-valued traits: speech
of the autocovariance of the function-valued traits unsound evolution. Trends in Ecology & Evolution.
der study. This estimate has the attractions both of
2012;27(3):160‚Äì166.
being positive definite (by construction) and of taking
[7] Stinchcombe JR, ‚ÄùFunction-valued Traits Workphylogeny into account.
ing Group‚Äù, Kirkpatrick M. Phylogenetic inVarious frameworks exist which could be used to
ference for function-valued traits: speech sound
generalise the method presented in Sec. 2.4, to
evolution. Trends in Ecology & Evolution.
model heterogeneity of evolutionary rates along the
2012;27(11):637‚Äì647.
branches of a phylogeny [38] or for multiple fixed [15]
or randomly evolving [39, 16] local optima of the mix[8] Pletcher SD, Geyer CJ. The genetic analysis
ing coefficients. For the stationary OU process the
of age-dependent traits: modeling the character
optimum trait value appears only in the mean, and
process. Genetics. 1999;153(2):825‚Äì35.
not in the covariance function, and so does not play
[9] Kingsolver JG, Gomulkiewicz R, Carter PA.
a role as a parameter in GPR (see [20]). We have
Variation, selection and evolution of functionnot implemented such extensions here, effectively asvalued traits. Genetica. 2001;112-113:87‚Äì104.
suming that a single fixed optimum is adequate for
each mixing coefficient. Nonetheless our framework is [10] Zhang Z, MuÃàller HG. Functional density synreadily extensible to include such effects, either imchronization. Computational Statistics and Data
plicitly through branch-length transformations [40],
Analysis. 2011;(55):2234‚Äì2249.
or explicitly by replacing the OU model with the more
[11] Moss SP, Joyce DA, Humphries S, Tindall KJ,
general Hansen model [39].
Lunt DH.
Comparative analysis of teleost
R Code for the IPCA, ancestral reconstruction and
genome sequences reveals an ancient intron size
hyperparameter estimation is available from
expansion in the zebrafish lineage. Genome bihttps://github.com/fpgpr/
ology and evolution. 2011;3:1187‚Äì96.
[12] Knight CG, Kassen R, Hebestreit H, Rainey
PB. Global analysis of predicted proteomes:
functional adaptation of physical properties.
Proceedings of the National Academy of Sciences of the United States of America. 2004
Jun;101(22):8390‚Äì8395.

References
[1] Maddison DR, Schulz KS. The Tree of Life Web
Project; 2007. http://tolweb.org.

[2] Li H, Coghlan A, Ruan J, Coin LJ, HeÃÅricheÃÅ
JK, Osmotherly L, et al. TreeFam: a cu- [13] Jones NS, Moriarty J. Evolutionary Inference
rated database of phylogenetic trees of animal
for Function-valued Traits: Gaussian Process
gene families. Nucleic Acids Research. 2006
Regression on Phylogenies. J R Soc Interface.
Jan;34:D572‚ÄìD580.
2013;10(78).
[3] Yang Z, Rannala B. Molecular phylogenetics: [14] Yao F, Coquery J, Le Cao KA. Independent Principal Component Analysis for biologprinciples and practice. Nature Reviews Genetically meaningful dimension reduction of large
ics. 2012;13(5):303‚Äì14.
biological data sets.
BMC Bioinformatics.
2012;13(1):13‚Äì24.
[4] Cheverud JM, Dow MM, Leutenegger W. The
Quantitative Assessment of Phylogenetic Con- [15] Butler MA, King AA.
Phylogenetic Comstraints in Comparative Analyses: Sexual Diparative Analysis: A Modelling Approach for
morphism in Body Weight Among Primates.
Adaptive Evolution.
American Naturalist.
Evolution. 1985;39(6):pp. 1335‚Äì1351.
2004;164(6):683‚Äì695.
[5] Kirkpatric M, Heckman N. A quantitative ge- [16] Beaulieu JM, Jhwueng DC, Boettiger C,
netic model for growth, shape, reaction norms,
OMÃÅeara BC. Modeling stabilizing selection: exand other infinite-dimensional characters. Jourpanding the Ornstein-Uhlenbeck model of adapnal of Mathematical Biology. 1989;27:429‚Äì450.
tive evolution. Evolution. 2012;8(66):2369‚Äì2383.
9

[17] Breiman L. Bagging Predictors. Machine Learn- [31] Hadfield JD, Nakagawa S. General quantitative
ing. 1996;24:123‚Äì140.
genetic methods for comparative biology: phylogenies, taxonomies and multi-trait models for
[18] Venditti C, Meade A, Pagel M. Phylogenies
continuous and categorical characters. Journal
reveal new interpretation of speciation and the
of Evolutionary Biology. 2010;23(3):494‚Äì508.
Red Queen. Nature. 2010;463(7279):349‚Äì52.
[32] Kerr M. Evolutionary inference for functional
[19] Hansen T. Stabilizing Selection and the Comdata: using Gaussian processes on phylogenies
parative Analysis of Adaptation. Evolution.
of functional data objects; 2012. MSc Thesis 1997;51(5):1341‚Äì1351.
Univ. of Glasgow.
[20] Rasmussen CE, Williams CKI. Gaussian Pro[33] Yao F, MuÃàller HG, Wang JL. Functional data
cesses for Machine Learning. MIT Press; 2006.
analysis for sparse longitudinal data. Journal of the American Statistical Association.
[21] HyvaÃàrinen A, Oja E. Independent component
2005;100(470):577‚Äì590.
analysis: algorithms and applications. Neural
Networks. 2000;13(4-5):411‚Äì430.
[34] Cardoso JF. High-Order Contrasts for Independent Component Analysis. Neural Computation.
[22] Bishop C. Pattern Recognition and Machine
1999;11:157‚Äì192.
Learning. Springer; 2006.
[23] Revell LJ. Size-correction and principal compo- [35] Collar DC, O‚ÄôMeara BC, Wainwright PC, Near
nents for interspecific comparative studies. EvoTJ. Piscivory limits diversfication of feeding
lution. 2009;63(12):3258‚Äì3268.
morphology in centrarchid fishes. Evolution.
2009;63(6).
[24] Scholz M, Gatzek S, Sterling A, Fiehn O, Selbig
J. Metabolite fingerprinting: detecting biologi- [36] Pletcher SD, Geyer CJ. The Genetic Analysis of
cal features by independent component analysis.
Age-Dependent Traits: Modeling the Character
Bioinformatics. 2004;20(15):2447‚Äì2454.
Process. Genetics. 1999;153(2):825‚Äì835.
[25] Minka TP. Automatic choice of dimensionality [37] Kirkpatrick M, Heckman N. A quantitative gefor PCA. Advances in Neural Information Pronetic model for growth, shape, reaction norms,
cessing Systems. 2000;13:514.
and other infinite-dimensional characters. Journal of Mathematical Biology. 1989;27:429‚Äì450.
[26] Blaschke T, Wiskott L.
CuBICA: Independent Component Analysis by Simultaneous [38] Revell LJ, Collar DC. Phylogenetic analysis of
Third- and Fourth-Order Cumulant Diagonalthe evolutionary coreally using likelihood. Evoization. IEEE Transactions on Signal Processlution. 2009;(63-64):1090‚Äì1100.
ing. 2004;52(5):1250‚Äì1256.
[39] Hansen T, Pienaar J, Orzack SH. A com[27] Hansen T, Martins E. Translating between miparative method for studying adaptation to
croevolutionary process and macroevolutionary
a randomly evolving environment. Evolution.
patterns: the correlation structure of interspe2008;8(62):1965‚Äì1977.
cific data. Evolution. 1996;50(4):1404‚Äì1417.
[40] Pagel M. Inferring the historical patterns of bi[28] Pagel M. Inferring evolutionary processes from
ological evolution. Nature. 1999;401(6756):877‚Äì
phylogenies. Zoologica Scripta. 1997;26(4):331‚Äì
84.
348.
[29] Jaynes ET. Prior information and ambiguity in inverse problems.
Inverse Problems.
1984;14:151‚Äì166.
[30] Salamin N, Wuest RO, Lavergne S, Thuiller W,
Pearman PB. Assessing rapid evolution in a
changing environment. Trends in Ecology &
Evolution. 2010;25(12):692‚Äì8.
10

